#!/bin/perl -w
#
# https://adventofcode.com/2018/day/17

use strict;
use List::Util qw(sum);

# Only needed for visualization.
use Imager;

print "2018 Day 17\n\n";
my $puzzle = do { local $/; <DATA> }; # slurp it
my @lines = split("\n", $puzzle);

# Valid values are 'text' or 'image'; anything else turns off visualizations.
# The text "visualization" is just a series of ASCII dumps of the map grid.
# The image visualization eats memory and results in a ~25 MB gif.
my $visualization = 'none';
my (@vis, %vis_color, $vframe);

if ($visualization eq 'image') {
	@vis = ();
	$vframe = 0;
	# We don't know the limits of our drawing area yet so picking large defaults
	$vis[$vframe] = Imager->new(xsize=>1000, ysize=>2000, channels=>3);
	%vis_color = (
		'sand' => Imager::Color->new(192, 192, 192),
		'clay' => Imager::Color->new(64, 64, 64),
		'flow' => Imager::Color->new(72, 192, 224),
		'water' => Imager::Color->new(24, 120, 160),
	);
	$vis[$vframe]->flood_fill(x=>50, y=>50, color=>$vis_color{'sand'});	
}

my %grid = ();
my $min_x = 999;
my $max_x = 0;
my $min_y = 999;
my $max_y = 0;
for (my $i = 0; $i < scalar(@lines); $i++) {
	(my ($a, $b, $c)) = $lines[$i] =~ /(\d+)/g;
	if ($lines[$i] =~ /^x/) {
		for (my $y = $b; $y <= $c; $y++) {
			$grid{"$a,$y"} = '#';
		}
		$max_x = ($a + 1) if ($a > $max_x);
		$min_x = ($a - 1) if ($a < $min_x);
		$max_y = $c if ($c > $max_y);
		$min_y = $b if ($b < $min_y);
		if ($visualization eq 'image') {
			$vis[$vframe]->line(color=>$vis_color{'clay'}, x1=>$a, x2=>$a, y1=>$b, y2=>$c );
		}
	} else {
		for (my $x = $b; $x <= $c; $x++) {
			$grid{"$x,$a"} = '#';
		}
		$max_x = ($c + 1) if ($c > $max_x);
		$min_x = ($b - 1) if ($b < $min_x);
		$max_y = $a if ($a > $max_y);
		$min_y = $a if ($a < $min_y);
		if ($visualization eq 'image') {
			$vis[$vframe]->line(color=>$vis_color{'clay'}, x1=>$b, x2=>$c, y1=>$a, y2=>$a );
		}
	}
}

$vis[$vframe] = $vis[0]->crop(left=>$min_x, right=>$max_x, top=>$min_y, bottom=>$max_y) if ($visualization eq 'image');

# Start at first valid y below the spring, which is at (500,0)
my @queue = ( { 'dir' => 'down', 'x' => 500, 'y' => $min_y } );

print_grid("Initial");

while (my $flow = shift @queue) {
	if (defined $grid{"$flow->{'x'},$flow->{'y'}"} and $grid{"$flow->{'x'},$flow->{'y'}"} ne '|') {
		# This can happen when 2 different down flows enter into the same pool.
	} else {
		if ($flow->{'dir'} eq 'down') {
			for (my $y = $flow->{'y'}; $y <= $max_y; $y++) {
				$grid{"$flow->{'x'},$y"} = '|';
				my $next_y = $y + 1;
				if (defined $grid{"$flow->{'x'},$next_y"} and 
					($grid{"$flow->{'x'},$next_y"} eq '#' or $grid{"$flow->{'x'},$next_y"} eq '~')) {
					# Clay or standing water below us, end the downflow and queue an LR flow.
					push @queue, { 'dir' => 'lr', 'x' => $flow->{'x'}, 'y' => $y };
					last;
				}
			}
		} elsif ($flow->{'dir'} eq 'lr') {
			my ($left, $right);
			my $next_y = $flow->{'y'} + 1;
			my $clay_on_left = 0;
			for ($left = $flow->{'x'}; $left >= $min_x; $left--) {
				$grid{"$left,$flow->{'y'}"} = '|';
				if (not defined $grid{"$left,$next_y"} or $grid{"$left,$next_y"} eq '|') {
					push @queue, { 'dir' => 'down', 'x' => $left, 'y' => $next_y };
					last;
				}
				my $next_x = $left - 1;
				if (defined $grid{"$next_x,$flow->{'y'}"} and $grid{"$next_x,$flow->{'y'}"} eq '#') {
					$clay_on_left = 1;
					last;
				}
			}
			my $clay_on_right = 0;
			for ($right = $flow->{'x'}; $right <= $max_x; $right++) {
				$grid{"$right,$flow->{'y'}"} = '|';
				if (not defined $grid{"$right,$next_y"} or $grid{"$right,$next_y"} eq '|') {
					push @queue, { 'dir' => 'down', 'x' => $right, 'y' => $next_y };
					last;
				}
				my $next_x = $right + 1;
				if (defined $grid{"$next_x,$flow->{'y'}"} and $grid{"$next_x,$flow->{'y'}"} eq '#') {
					$clay_on_right = 1;
					last;
				}
			}
			if ($clay_on_left and $clay_on_right) {
				# We are in a basin so we must convert these tiles to standing water and queue another LR above.
				for (my $x = $left; $x <= $right; $x++) {
					$grid{"$x,$flow->{'y'}"} = '~';
				}
				$next_y = $flow->{'y'} - 1;
				if ( $next_y >= $min_y ) {
					push @queue, { 'dir' => 'lr', 'x' => $flow->{'x'}, 'y' => $next_y };
				}
			}
			print_grid("After $flow->{'dir'} flow starting at ($flow->{'x'}, $flow->{'y'})\n");
		} else {
			warn "Unknown flow direction $flow->{'dir'}\n";
		}
	}
}

print_grid("End");
Imager->write_multi({file=>"vis_day_17.gif", type=>'gif', gif_loop=>0, gif_delay=>25, gif_disposal=>2}, @vis) if ($visualization eq 'image');

my $water_count = 0;
my $flow_count = 0;
for (my $y = $min_y; $y <= $max_y; $y++) {
	for (my $x = $min_x; $x <= $max_x; $x++) {
		if (defined $grid{"$x,$y"}) {
			if ($grid{"$x,$y"} eq '|') {
				$flow_count++;
			} elsif ($grid{"$x,$y"} eq '~') {
				$water_count++;
			}
		}
	}
}
print "P1: There are ", ($flow_count + $water_count), " total water & flowing water tiles.\n";
print "P2: There are $water_count total water tiles\n";
exit;

sub print_grid {
	my $title = shift;
	$title = "" unless defined $title;	
	$title .= "\nSpans x = ($min_x .. $max_x) and y = ($min_y .. $max_y)";
	
	if ($visualization eq 'text') {
		print_grid_text($title);
	} elsif ($visualization eq 'image') {
		print_grid_image($title);
	}
}

sub print_grid_image {
	my $title = shift;
	# Title not actually used for image visualization
	
	$vframe++;
	$vis[$vframe] = $vis[0]->copy();
	
	for (my $y = $min_y; $y <= $max_y; $y++) {
		for (my $x = $min_x; $x <= $max_x; $x++) {
			if (defined $grid{"$x,$y"}) {
				if ($grid{"$x,$y"} eq '|') {
					$vis[$vframe]->setpixel(x=>($x - $min_x), y=>($y - $min_y), color=>$vis_color{'flow'});
				} elsif ($grid{"$x,$y"} eq '~') {
					$vis[$vframe]->setpixel(x=>($x - $min_x), y=>($y - $min_y), color=>$vis_color{'water'});
				}
			}
		}
	}
}

sub print_grid_text {
	my $title = shift;
	
	print "\n$title\n";
	for (my $y = $min_y; $y <= $max_y; $y++) {
		my $line = "";
		for (my $x = $min_x; $x <= $max_x; $x++) {
			my $char = (defined $grid{"$x,$y"}) ? $grid{"$x,$y"} : ".";
			$line .= $char;
		}
		print "$line\n";
	}
}

__DATA__
x=516, y=699..702
y=1480, x=619..642
x=518, y=429..441
x=625, y=1257..1259
y=1258, x=508..527
x=466, y=494..503
x=502, y=1209..1220
y=1703, x=507..523
x=562, y=1739..1748
x=493, y=659..663
x=598, y=878..885
y=1694, x=460..463
y=387, x=618..628
x=591, y=457..471
y=228, x=490..513
x=639, y=1599..1601
x=595, y=1196..1201
x=479, y=1436..1460
x=544, y=28..30
y=282, x=674..680
y=651, x=516..529
y=1024, x=497..499
x=460, y=819..831
x=621, y=466..472
x=593, y=791..795
y=334, x=489..517
x=652, y=548..575
x=459, y=273..300
y=726, x=492..518
x=682, y=739..765
x=479, y=1034..1041
y=1142, x=516..537
y=194, x=612..614
x=642, y=1465..1480
x=632, y=596..608
y=1326, x=481..487
x=479, y=1706..1726
y=1142, x=621..625
x=549, y=639..645
x=564, y=106..121
y=471, x=568..591
y=752, x=667..672
y=456, x=486..488
y=140, x=491..493
x=687, y=1390..1392
y=34, x=534..552
y=1517, x=653..675
x=563, y=217..223
y=1527, x=564..566
x=618, y=1113..1131
x=565, y=1640..1645
x=673, y=199..203
x=611, y=467..494
y=937, x=461..476
y=111, x=682..687
y=1502, x=628..635
x=646, y=339..344
x=548, y=127..137
x=494, y=538..542
x=527, y=431..444
x=661, y=659..681
x=667, y=214..215
x=533, y=228..254
x=575, y=849..851
y=468, x=576..585
y=320, x=648..674
y=1644, x=591..595
x=521, y=494..506
x=514, y=1591..1607
y=1669, x=600..618
x=592, y=160..171
x=636, y=1652..1661
x=595, y=1744..1747
y=1276, x=516..573
y=1203, x=487..510
y=1711, x=585..596
x=615, y=313..339
y=179, x=513..535
x=577, y=1653..1673
x=552, y=822..833
y=1086, x=671..675
x=516, y=283..297
y=1787, x=491..493
x=476, y=958..970
x=609, y=1136..1146
y=1273, x=491..495
y=1150, x=487..508
x=459, y=597..610
x=671, y=859..861
x=472, y=1355..1374
y=916, x=536..554
x=522, y=1447..1454
x=465, y=1720..1722
x=530, y=1450..1461
x=528, y=1152..1162
x=530, y=306..317
x=520, y=452..463
y=1559, x=682..685
y=1266, x=591..598
x=579, y=801..819
x=527, y=976..985
x=536, y=906..916
x=569, y=1089..1111
x=650, y=512..531
y=1653, x=670..684
x=472, y=1118..1122
x=670, y=514..536
y=1795, x=628..632
x=482, y=1412..1433
x=642, y=1019..1037
y=979, x=634..662
y=885, x=592..598
x=515, y=408..418
x=493, y=922..942
y=503, x=578..588
x=497, y=1033..1041
y=645, x=549..564
x=544, y=511..520
y=727, x=677..687
x=663, y=23..34
x=541, y=1095..1105
x=514, y=600..611
y=1019, x=536..543
y=1374, x=472..489
x=492, y=714..726
x=468, y=165..188
y=723, x=589..596
x=612, y=1664..1666
y=364, x=516..529
x=497, y=822..834
y=137, x=546..548
x=481, y=1318..1326
x=627, y=1021..1038
y=1571, x=490..494
x=647, y=773..794
y=629, x=546..550
x=670, y=643..662
x=548, y=38..54
x=505, y=619..629
x=614, y=1237..1249
x=612, y=186..194
y=891, x=486..491
y=762, x=483..508
x=480, y=910..918
x=637, y=1048..1064
y=300, x=459..463
y=856, x=641..649
x=463, y=1666..1694
x=554, y=1602..1619
y=1143, x=673..687
x=674, y=312..320
x=596, y=1689..1711
y=1573, x=570..591
x=500, y=1390..1400
y=310, x=562..586
y=1631, x=578..601
y=1119, x=659..672
y=223, x=538..563
x=519, y=408..418
x=568, y=1324..1334
x=644, y=866..870
y=127, x=462..470
y=1111, x=569..585
y=77, x=615..637
x=649, y=473..483
y=819, x=579..581
x=578, y=1618..1631
y=769, x=529..550
y=30, x=540..544
y=769, x=635..642
y=952, x=628..638
x=551, y=1031..1045
y=1556, x=481..645
x=567, y=1639..1645
y=93, x=576..591
y=277, x=578..588
y=1145, x=599..601
x=641, y=442..452
x=573, y=160..171
x=672, y=668..690
y=483, x=508..555
y=119, x=522..538
y=979, x=508..520
y=583, x=572..581
y=1129, x=495..499
x=593, y=1431..1441
y=338, x=600..605
x=583, y=230..233
x=610, y=448..451
x=589, y=448..451
x=529, y=755..769
x=507, y=219..222
x=463, y=164..188
x=634, y=414..422
x=644, y=1318..1323
x=533, y=1032..1045
y=755, x=618..623
x=582, y=1138..1147
x=470, y=101..127
x=524, y=1085..1091
x=632, y=1795..1798
x=648, y=755..758
x=496, y=538..542
y=1212, x=534..539
y=1549, x=664..670
x=504, y=768..776
y=1499, x=481..625
y=816, x=517..529
x=553, y=1461..1476
y=673, x=573..577
x=661, y=832..845
x=616, y=1267..1285
y=1442, x=494..514
x=578, y=487..503
y=1045, x=533..551
y=1683, x=476..478
y=246, x=504..508
x=540, y=309..320
x=539, y=1475..1479
x=658, y=1404..1409
x=562, y=289..310
x=475, y=1510..1514
y=1064, x=637..655
y=1460, x=460..479
y=1220, x=502..529
y=209, x=552..557
x=634, y=976..979
y=1435, x=550..557
x=614, y=352..365
x=515, y=385..395
y=624, x=564..588
y=734, x=558..565
y=1722, x=465..475
x=649, y=339..344
x=667, y=228..233
x=481, y=341..367
x=486, y=90..93
x=587, y=1624..1628
x=576, y=1785..1787
x=542, y=1189..1200
x=684, y=1178..1188
x=477, y=1732..1753
y=467, x=498..502
y=734, x=489..497
x=674, y=1782..1793
x=546, y=614..629
y=1149, x=637..650
x=600, y=998..1016
x=589, y=950..971
x=639, y=1112..1131
x=513, y=215..228
y=90, x=583..585
x=676, y=23..34
x=626, y=118..122
x=479, y=598..610
x=504, y=1195..1199
y=1643, x=616..619
x=555, y=1461..1476
x=490, y=1567..1571
x=459, y=1009..1012
x=479, y=230..238
y=1305, x=645..649
y=1065, x=516..520
x=478, y=766..772
x=667, y=660..681
x=498, y=465..467
x=675, y=643..662
x=550, y=756..769
x=664, y=1535..1549
x=459, y=700..725
x=648, y=1258..1259
y=749, x=560..562
y=404, x=637..665
y=181, x=540..557
x=668, y=922..930
x=619, y=1705..1709
x=467, y=553..563
y=1698, x=660..679
y=1433, x=482..489
x=605, y=1409..1421
x=508, y=1249..1258
y=251, x=519..524
x=658, y=473..483
x=586, y=1587..1590
x=506, y=410..423
x=486, y=456..458
x=525, y=29..42
y=833, x=552..574
x=526, y=693..706
x=529, y=1209..1220
x=480, y=674..686
x=468, y=819..831
x=687, y=87..111
x=581, y=801..819
y=1752, x=626..650
x=574, y=111..115
x=532, y=107..116
x=481, y=1290..1291
x=565, y=784..787
y=1038, x=655..659
x=604, y=403..405
x=592, y=1237..1249
y=971, x=589..595
y=648, x=471..494
x=654, y=1565..1576
x=530, y=1013..1023
y=834, x=497..506
y=1104, x=590..610
y=40, x=638..640
y=1579, x=645..662
x=617, y=1527..1537
x=515, y=1718..1725
x=646, y=147..173
x=508, y=517..527
y=1438, x=499..506
x=588, y=1305..1315
x=635, y=1701..1712
x=662, y=1512..1514
x=497, y=1099..1105
x=616, y=820..833
x=618, y=1659..1669
x=675, y=1390..1412
x=674, y=954..977
x=470, y=1638..1643
y=1461, x=514..530
y=736, x=599..615
y=525, x=477..480
x=607, y=1376..1382
x=631, y=1373..1380
x=610, y=1097..1104
y=1643, x=460..470
x=501, y=1195..1199
y=1318, x=575..594
x=655, y=1359..1370
y=725, x=459..464
x=625, y=1486..1499
y=1197, x=474..479
x=557, y=1432..1435
x=479, y=1572..1592
x=481, y=1542..1556
x=604, y=1678..1692
y=197, x=595..622
x=598, y=424..441
x=609, y=1676..1689
y=527, x=492..508
x=492, y=1508..1520
x=596, y=303..311
x=508, y=1126..1150
x=529, y=1167..1179
y=542, x=494..496
x=562, y=801..813
y=590, x=470..496
x=527, y=1248..1258
x=523, y=388..399
x=614, y=186..194
x=536, y=92..102
x=529, y=802..816
y=1705, x=619..625
y=1785, x=576..580
x=666, y=1633..1643
x=556, y=967..979
y=39, x=606..610
x=649, y=1438..1459
y=758, x=648..655
x=524, y=1136..1139
x=586, y=565..571
x=516, y=429..441
x=490, y=391..394
y=233, x=561..583
x=609, y=619..629
y=1108, x=467..470
x=548, y=189..205
x=503, y=1756..1768
y=1281, x=650..652
y=1611, x=679..683
x=559, y=531..547
y=776, x=489..504
y=1720, x=490..494
x=657, y=1296..1309
y=1392, x=680..687
y=840, x=492..514
x=555, y=1139..1147
y=1682, x=529..532
x=493, y=55..66
y=1229, x=604..610
x=578, y=254..277
y=116, x=530..532
x=515, y=239..250
x=585, y=88..90
x=505, y=1004..1030
x=558, y=1327..1340
x=476, y=1656..1683
x=629, y=1474..1476
y=1139, x=524..531
x=598, y=1263..1266
x=530, y=107..116
y=422, x=606..634
x=497, y=515..524
x=654, y=1594..1611
y=205, x=637..659
x=677, y=515..536
y=63, x=503..506
y=1341, x=653..655
x=576, y=111..115
x=494, y=1432..1442
x=614, y=1676..1689
y=242, x=572..578
x=538, y=129..140
x=680, y=1160..1168
y=503, x=466..475
y=233, x=643..667
x=547, y=443..446
x=535, y=764..766
x=662, y=1567..1579
x=574, y=7..10
y=1146, x=609..632
x=619, y=1466..1480
y=985, x=527..547
x=559, y=1513..1539
x=555, y=991..1000
x=567, y=1798..1810
y=806, x=486..503
x=561, y=231..233
y=1139, x=621..625
x=547, y=368..378
x=510, y=432..444
y=341, x=540..558
x=585, y=466..468
x=669, y=907..909
x=486, y=4..10
x=472, y=870..894
x=517, y=11..21
x=534, y=12..34
y=549, x=512..518
x=543, y=778..791
y=1747, x=595..601
x=481, y=555..569
y=397, x=583..599
x=520, y=1716..1728
x=599, y=734..736
y=269, x=515..517
y=536, x=670..677
x=623, y=1439..1459
x=542, y=840..854
y=538, x=564..566
x=557, y=348..360
y=644, x=651..660
y=930, x=642..668
x=520, y=1470..1481
y=1792, x=561..586
y=1537, x=598..617
x=601, y=1140..1145
y=802, x=492..494
x=651, y=627..644
x=478, y=1657..1683
y=506, x=494..521
y=1788, x=507..534
x=633, y=438..459
x=657, y=1359..1370
x=485, y=32..46
x=575, y=531..547
x=575, y=1287..1300
x=573, y=763..765
x=595, y=1642..1644
x=511, y=1719..1725
x=498, y=871..894
x=618, y=381..387
x=551, y=799..808
x=621, y=1139..1142
x=525, y=1750..1760
y=894, x=472..498
y=575, x=650..652
x=658, y=438..459
y=1037, x=642..647
x=660, y=1637..1640
y=483, x=649..658
y=1331, x=634..651
x=642, y=1395..1417
x=595, y=950..971
x=559, y=1688..1695
x=640, y=1784..1806
x=667, y=774..794
x=637, y=54..77
x=578, y=238..242
x=499, y=1129..1141
x=514, y=1449..1461
y=1131, x=618..639
x=640, y=1349..1373
x=495, y=1504..1526
y=1075, x=595..608
y=386, x=631..655
y=1459, x=623..649
y=222, x=503..507
x=614, y=633..649
y=785, x=550..554
x=581, y=894..913
y=833, x=614..616
y=1673, x=563..577
y=1637, x=654..660
y=910, x=544..547
x=575, y=1307..1318
x=637, y=1228..1247
x=665, y=69..85
x=568, y=388..390
x=468, y=90..93
x=573, y=1263..1276
y=459, x=633..658
x=576, y=466..468
x=488, y=1733..1753
x=479, y=453..463
x=556, y=1058..1060
x=506, y=387..399
y=1742, x=637..642
y=1012, x=459..475
x=535, y=169..179
x=586, y=106..121
x=591, y=79..93
y=472, x=621..625
x=617, y=458..464
x=681, y=668..690
y=611, x=654..680
x=599, y=1140..1145
x=560, y=1770..1776
x=495, y=1308..1333
x=559, y=1033..1050
x=535, y=1444..1448
x=668, y=865..870
x=480, y=1255..1277
x=487, y=1052..1080
y=1141, x=495..499
x=659, y=1013..1038
x=675, y=335..355
x=552, y=188..209
y=870, x=609..633
y=1725, x=511..515
y=1315, x=584..588
x=479, y=957..985
x=576, y=1275..1277
x=488, y=1583..1610
x=476, y=915..937
x=680, y=586..611
x=680, y=1762..1772
x=459, y=1572..1592
x=648, y=313..320
y=1473, x=661..686
y=791, x=543..560
x=634, y=1590..1604
x=656, y=136..160
x=516, y=348..364
x=489, y=957..985
y=1476, x=629..635
x=627, y=664..688
x=673, y=547..575
y=1334, x=565..568
y=171, x=573..592
x=536, y=1640..1657
y=1075, x=492..498
x=497, y=659..663
x=547, y=977..985
y=524, x=497..502
y=1576, x=654..656
x=488, y=655..667
x=549, y=994..1003
y=579, x=613..634
x=570, y=1564..1573
y=314, x=463..488
y=237, x=607..632
y=913, x=561..581
x=502, y=534..548
x=687, y=1126..1143
x=574, y=822..833
y=1117, x=550..555
x=637, y=186..205
y=1706, x=554..570
x=536, y=1010..1019
x=510, y=1283..1291
y=690, x=672..681
x=500, y=922..942
x=474, y=1173..1197
x=658, y=1512..1514
x=523, y=260..272
x=651, y=1672..1681
x=512, y=1346..1364
x=655, y=755..758
x=565, y=758..768
y=520, x=544..572
x=655, y=1338..1341
y=765, x=573..578
x=576, y=783..787
y=737, x=489..497
x=580, y=997..1016
y=909, x=664..669
x=684, y=1207..1221
x=497, y=238..250
x=588, y=488..503
x=508, y=761..762
x=686, y=1447..1473
y=1277, x=576..599
x=599, y=378..397
x=516, y=1263..1276
y=531, x=640..650
x=489, y=768..776
x=588, y=1799..1805
y=1751, x=587..607
y=1085, x=530..554
y=205, x=536..548
y=394, x=559..578
x=475, y=494..503
x=570, y=1683..1706
y=1476, x=553..555
x=523, y=1675..1703
y=1534, x=607..610
x=634, y=1329..1331
y=317, x=530..532
x=518, y=881..895
y=1225, x=532..552
x=644, y=1614..1628
x=503, y=1505..1526
y=964, x=603..631
y=1023, x=530..549
x=635, y=1474..1476
x=659, y=4..8
y=1016, x=580..600
x=626, y=1375..1382
x=670, y=1288..1303
x=645, y=1543..1556
x=493, y=132..140
x=649, y=838..856
y=541, x=564..566
x=504, y=152..165
x=639, y=245..261
x=628, y=1638..1649
x=539, y=519..539
x=610, y=18..39
x=476, y=1100..1105
x=588, y=253..277
y=1402, x=565..567
y=1051, x=647..649
y=1481, x=503..520
x=533, y=1172..1177
y=525, x=600..614
x=633, y=868..870
x=539, y=1207..1212
x=591, y=1264..1266
x=503, y=655..667
x=645, y=1568..1579
x=640, y=1314..1318
x=568, y=456..471
x=640, y=511..531
x=568, y=264..266
x=472, y=553..563
x=590, y=1128..1154
y=800, x=492..494
y=1360, x=520..585
y=895, x=518..536
x=636, y=1021..1044
x=628, y=620..629
y=813, x=672..674
x=662, y=799..816
x=482, y=230..238
y=8, x=632..659
y=272, x=509..523
x=557, y=187..209
y=1197, x=572..575
y=1712, x=607..635
y=768, x=565..584
y=702, x=512..516
y=10, x=574..602
y=62, x=575..578
y=297, x=621..632
x=578, y=376..394
x=554, y=785..787
y=433, x=585..592
x=499, y=1435..1438
x=667, y=752..759
y=1611, x=654..664
y=441, x=570..598
x=481, y=534..548
y=1421, x=507..605
x=489, y=328..334
x=687, y=548..575
y=1091, x=497..524
y=547, x=559..575
y=937, x=518..536
y=254, x=531..533
x=516, y=55..66
x=564, y=1285..1297
x=625, y=1139..1142
y=10, x=471..486
x=519, y=238..251
y=690, x=460..464
x=551, y=949..962
y=629, x=609..628
x=493, y=1785..1787
x=515, y=265..269
x=517, y=801..816
x=516, y=1060..1065
x=652, y=146..173
x=495, y=1129..1141
x=567, y=207..227
y=1295, x=496..516
x=595, y=177..197
y=1303, x=670..677
y=1093, x=614..630
y=1810, x=567..570
x=517, y=385..395
y=1323, x=644..666
y=794, x=647..667
x=525, y=411..423
x=509, y=259..272
x=506, y=1435..1438
y=1285, x=604..616
x=679, y=1584..1611
x=599, y=862..873
x=465, y=1470..1483
y=227, x=567..579
x=553, y=1058..1060
y=360, x=538..557
y=110, x=601..621
x=666, y=1719..1729
y=21, x=499..517
x=530, y=28..42
y=297, x=516..538
x=630, y=1068..1093
x=541, y=452..463
x=536, y=882..895
y=1798, x=628..632
x=544, y=802..813
y=355, x=675..680
x=508, y=765..773
x=575, y=1326..1340
y=1454, x=522..524
y=1607, x=514..520
x=680, y=1391..1392
x=516, y=629..651
y=1058, x=647..649
y=1776, x=538..560
x=580, y=1785..1787
y=942, x=493..500
x=523, y=369..378
x=504, y=236..246
x=641, y=70..85
x=664, y=876..899
y=611, x=496..514
x=635, y=751..769
x=545, y=1325..1327
x=479, y=1174..1197
x=610, y=1215..1229
x=622, y=177..197
y=18, x=504..509
x=494, y=635..648
y=744, x=468..536
y=1628, x=621..644
y=1805, x=588..609
x=601, y=107..110
x=564, y=640..645
x=564, y=1053..1063
x=468, y=1117..1122
x=592, y=879..885
x=621, y=108..110
x=498, y=342..367
y=662, x=670..675
y=877, x=486..491
y=539, x=534..539
x=638, y=1276..1290
x=578, y=402..405
x=570, y=1798..1810
x=646, y=685..710
x=473, y=1510..1514
x=467, y=1093..1108
y=1080, x=473..487
x=591, y=1564..1573
x=660, y=1676..1698
x=566, y=1524..1527
x=602, y=1723..1726
x=587, y=1525..1526
x=509, y=1306..1320
x=632, y=281..297
y=1692, x=604..620
x=638, y=735..739
x=550, y=785..787
x=592, y=428..433
y=1125, x=512..528
y=1162, x=528..552
x=634, y=1212..1221
x=633, y=1394..1417
y=765, x=660..682
x=592, y=906..932
x=516, y=766..773
x=683, y=1585..1611
x=677, y=1159..1168
x=591, y=1642..1644
x=524, y=1513..1520
y=452, x=641..647
x=502, y=515..524
y=1772, x=574..680
x=514, y=1230..1241
y=649, x=614..629
y=1768, x=503..512
x=673, y=1041..1049
x=507, y=1675..1703
y=1549, x=634..639
x=583, y=88..90
x=473, y=767..772
x=500, y=1584..1610
x=460, y=1289..1291
x=621, y=1615..1628
x=562, y=1444..1448
y=1643, x=643..666
x=493, y=152..165
x=562, y=743..749
x=655, y=378..386
x=647, y=1051..1058
y=423, x=506..525
x=484, y=1707..1726
x=661, y=1653..1664
y=140, x=538..554
x=670, y=1535..1549
x=562, y=572..578
x=483, y=760..762
x=552, y=12..34
x=655, y=860..861
x=575, y=1436..1456
y=1337, x=532..551
x=652, y=1527..1553
y=167, x=560..562
x=491, y=877..891
y=463, x=479..494
y=1188, x=666..684
x=581, y=925..930
x=467, y=390..394
x=503, y=1470..1481
y=1666, x=609..612
y=899, x=654..664
x=584, y=1305..1315
x=569, y=969..982
x=529, y=349..364
y=458, x=486..488
x=635, y=1487..1502
x=689, y=1783..1793
x=560, y=39..54
y=1221, x=666..684
y=851, x=571..575
x=464, y=687..690
x=558, y=1388..1394
y=1483, x=465..470
x=503, y=219..222
x=508, y=474..483
x=666, y=1206..1221
x=570, y=425..441
x=491, y=1229..1241
x=680, y=282..285
x=594, y=1624..1628
x=503, y=791..806
y=773, x=508..516
x=685, y=1547..1559
y=1268, x=491..495
x=680, y=336..355
x=598, y=1528..1537
y=1610, x=488..500
x=549, y=1641..1657
x=584, y=650..677
y=575, x=673..687
y=153, x=530..532
x=532, y=1218..1225
x=667, y=497..520
y=77, x=527..535
x=505, y=693..706
x=662, y=409..425
x=540, y=329..341
x=483, y=1782..1801
x=623, y=1333..1344
y=808, x=551..554
x=528, y=948..962
x=580, y=163..165
x=655, y=736..739
y=294, x=474..493
x=637, y=664..688
x=594, y=1308..1318
x=665, y=1404..1409
y=121, x=564..586
y=1649, x=608..628
x=522, y=109..119
y=688, x=627..637
x=535, y=57..77
y=127, x=653..679
x=600, y=1658..1669
x=538, y=349..360
x=567, y=993..1003
y=1787, x=576..580
x=486, y=792..806
y=1300, x=555..575
x=544, y=953..958
y=394, x=467..490
y=1030, x=489..505
x=588, y=784..802
x=619, y=1641..1643
x=482, y=73..83
y=1060, x=553..556
x=481, y=1486..1499
x=604, y=1215..1229
x=549, y=1012..1023
x=662, y=975..979
x=561, y=1783..1792
x=555, y=1110..1117
x=665, y=1351..1373
x=504, y=597..607
x=491, y=132..140
y=861, x=655..671
x=546, y=1513..1520
x=677, y=1289..1303
x=554, y=130..140
x=686, y=266..289
x=544, y=1569..1592
x=524, y=1447..1454
x=638, y=26..40
x=661, y=1446..1473
y=1259, x=625..648
x=605, y=326..338
y=1007, x=667..674
x=614, y=821..833
x=584, y=758..768
y=425, x=648..662
x=518, y=928..937
x=530, y=153..155
x=544, y=265..266
y=607, x=504..508
x=520, y=1251..1254
x=484, y=618..629
x=551, y=326..335
x=595, y=42..65
x=520, y=1061..1065
x=617, y=1197..1201
x=563, y=925..930
x=499, y=1024..1027
x=672, y=1115..1119
x=615, y=1431..1441
y=1000, x=555..560
x=554, y=799..808
x=558, y=328..341
y=962, x=528..551
y=215, x=664..667
x=583, y=163..165
x=551, y=346..356
x=639, y=1549..1551
x=541, y=1563..1589
x=506, y=33..46
x=564, y=538..541
x=606, y=19..39
y=1514, x=658..662
y=1201, x=595..617
x=512, y=1115..1125
x=544, y=903..910
x=529, y=863..873
x=610, y=595..608
x=624, y=204..206
y=335, x=549..551
x=660, y=628..644
x=462, y=243..253
x=507, y=1775..1788
x=534, y=518..539
x=565, y=1324..1334
x=492, y=1072..1075
x=614, y=515..525
x=669, y=135..160
x=626, y=1745..1752
x=522, y=1096..1105
x=550, y=1432..1435
x=602, y=7..10
x=634, y=1549..1551
y=1664, x=649..661
x=538, y=1771..1776
y=347, x=640..655
x=541, y=953..958
x=463, y=273..300
x=536, y=1715..1728
y=1409, x=658..665
x=527, y=95..98
x=524, y=308..320
x=508, y=597..607
y=595, x=547..560
x=629, y=1169..1184
y=1748, x=554..562
x=488, y=911..918
y=1370, x=655..657
x=664, y=908..909
y=441, x=516..518
x=496, y=599..611
x=609, y=1800..1805
x=572, y=512..520
x=625, y=467..472
y=1689, x=609..614
y=1769, x=615..664
y=1181, x=541..565
y=845, x=661..682
x=502, y=465..467
x=583, y=377..397
x=475, y=1009..1012
y=958, x=541..544
y=367, x=567..581
x=659, y=1116..1119
y=677, x=559..584
x=651, y=1329..1331
y=1105, x=476..497
x=631, y=379..386
x=496, y=1285..1295
y=1729, x=596..666
x=528, y=1116..1125
y=629, x=484..505
x=629, y=634..649
x=538, y=1172..1177
x=490, y=214..228
x=529, y=95..98
x=682, y=87..111
y=918, x=480..488
x=654, y=585..611
x=536, y=732..744
y=930, x=563..581
x=534, y=1775..1788
y=1027, x=497..499
y=1291, x=508..510
y=569, x=461..481
x=601, y=1744..1747
x=620, y=1679..1692
y=399, x=506..523
x=613, y=576..579
x=505, y=1656..1670
x=492, y=800..802
x=600, y=564..571
y=1359, x=655..657
x=638, y=927..952
x=655, y=1049..1064
x=640, y=27..40
x=637, y=1506..1519
y=1441, x=593..615
y=34, x=663..676
x=471, y=634..648
x=548, y=148..158
y=816, x=662..682
y=1793, x=674..689
x=568, y=903..908
x=615, y=733..736
y=203, x=501..523
x=585, y=428..433
x=506, y=822..834
x=494, y=1714..1720
x=494, y=495..506
y=115, x=574..576
y=1661, x=632..636
x=600, y=791..795
x=508, y=1283..1291
y=934, x=528..530
y=1380, x=631..633
x=572, y=903..908
x=614, y=1069..1093
y=1325, x=537..545
y=1526, x=495..503
y=970, x=463..476
y=1681, x=636..651
x=531, y=229..254
x=679, y=1528..1553
y=1604, x=634..651
y=802, x=588..606
y=173, x=646..652
x=499, y=10..21
x=585, y=1347..1360
x=653, y=108..127
x=460, y=688..690
x=518, y=537..549
x=562, y=156..167
x=576, y=1514..1539
y=1122, x=468..472
y=1340, x=558..575
x=550, y=613..629
x=489, y=1413..1433
x=560, y=991..1000
x=463, y=310..314
y=1202, x=565..581
x=507, y=1409..1421
x=531, y=1476..1479
x=543, y=346..356
x=674, y=282..285
x=539, y=764..766
y=908, x=568..572
x=641, y=838..856
x=513, y=1655..1670
y=1801, x=483..499
x=575, y=1190..1197
x=470, y=577..590
x=585, y=1088..1111
x=607, y=1702..1712
x=659, y=186..205
y=1394, x=531..558
x=552, y=1569..1592
x=516, y=1190..1200
x=603, y=960..964
y=1526, x=587..595
x=649, y=1051..1058
y=1177, x=533..538
x=460, y=1637..1643
y=1474, x=629..635
y=163, x=580..583
y=203, x=667..673
x=554, y=1738..1748
y=46, x=485..506
x=615, y=53..77
y=1373, x=648..665
x=496, y=577..590
x=587, y=1741..1751
x=600, y=514..525
x=560, y=593..595
y=1709, x=619..625
x=520, y=1347..1360
x=528, y=1564..1589
y=1147, x=555..582
y=1327, x=537..545
x=489, y=734..737
y=520, x=660..667
x=567, y=1602..1619
x=645, y=1302..1305
y=488, x=475..501
y=563, x=467..472
x=605, y=936..939
x=607, y=1740..1751
x=643, y=228..233
x=552, y=1153..1162
y=356, x=543..551
y=1640, x=654..660
x=642, y=921..930
x=510, y=1190..1203
y=1539, x=559..576
x=650, y=1147..1149
y=625, x=614..616
x=461, y=556..569
x=679, y=1675..1698
x=538, y=110..119
y=418, x=515..519
y=1664, x=624..643
x=629, y=547..552
y=1726, x=602..650
x=545, y=1054..1063
x=607, y=1525..1534
x=567, y=1285..1297
x=473, y=1053..1080
x=541, y=1170..1181
y=1382, x=607..626
x=487, y=1318..1326
y=93, x=468..486
y=320, x=524..540
y=1417, x=633..642
x=586, y=1782..1792
x=523, y=149..158
x=476, y=242..253
x=604, y=1267..1285
x=572, y=574..583
x=527, y=1307..1320
x=571, y=1436..1456
y=165, x=493..504
x=529, y=628..651
y=1333, x=468..495
y=1645, x=565..567
x=518, y=715..726
x=486, y=877..891
x=514, y=1432..1442
x=559, y=1801..1813
y=686, x=480..515
y=910, x=460..471
x=588, y=620..624
x=464, y=699..725
y=289, x=669..686
y=1199, x=501..504
x=560, y=155..167
x=512, y=699..702
x=499, y=1781..1801
x=596, y=1127..1154
x=560, y=742..749
x=561, y=893..913
y=1813, x=559..579
y=344, x=646..649
y=787, x=550..554
x=643, y=1634..1643
y=444, x=510..527
x=672, y=1456..1466
x=595, y=1524..1526
x=460, y=1667..1694
x=516, y=1132..1142
y=608, x=610..632
y=759, x=667..672
y=1551, x=634..639
x=550, y=1109..1117
x=463, y=957..970
x=488, y=311..314
x=547, y=903..910
x=632, y=3..8
y=365, x=614..616
x=541, y=1029..1038
x=581, y=341..367
x=508, y=236..246
y=1553, x=652..679
x=489, y=1003..1030
y=1726, x=479..484
x=648, y=408..425
y=739, x=638..655
x=497, y=734..737
x=590, y=1096..1104
y=463, x=520..541
x=631, y=961..964
x=679, y=107..127
y=206, x=611..624
x=554, y=1683..1706
x=597, y=935..939
x=497, y=1086..1091
y=158, x=523..548
x=667, y=983..1007
x=501, y=1167..1179
y=1520, x=524..546
x=512, y=1756..1768
x=547, y=1749..1760
x=611, y=302..311
x=460, y=904..910
x=564, y=1688..1695
y=979, x=556..559
x=491, y=1785..1787
x=672, y=752..759
y=1050, x=559..587
x=665, y=392..404
x=623, y=749..755
x=659, y=1275..1290
x=675, y=1060..1086
x=610, y=1525..1534
x=623, y=1168..1184
x=503, y=61..63
y=1479, x=531..539
x=489, y=1355..1374
x=650, y=1279..1281
y=68, x=468..478
x=642, y=751..769
x=534, y=1208..1212
y=932, x=589..592
x=487, y=1127..1150
y=710, x=646..665
x=559, y=1586..1590
x=566, y=538..541
x=480, y=518..525
x=664, y=213..215
y=772, x=473..478
x=642, y=1599..1601
y=367, x=481..498
y=130, x=614..633
y=1400, x=500..517
x=497, y=1024..1027
y=1105, x=522..541
x=467, y=1507..1520
x=571, y=849..851
y=1221, x=634..653
x=578, y=763..765
y=1381, x=510..596
y=66, x=493..516
y=188, x=463..468
y=466, x=576..585
x=655, y=1012..1038
x=572, y=239..242
x=616, y=623..625
x=628, y=928..952
y=1753, x=477..488
y=1154, x=590..596
y=681, x=661..667
y=610, x=459..479
y=238, x=479..482
y=1003, x=549..567
y=1318, x=481..487
x=653, y=1498..1517
y=1254, x=517..520
x=509, y=8..18
x=517, y=328..334
y=378, x=523..547
x=510, y=1369..1381
y=1760, x=525..547
x=606, y=784..802
y=939, x=597..605
x=517, y=1251..1254
x=530, y=925..934
y=1243, x=536..547
y=261, x=639..659
y=1297, x=564..567
y=1277, x=480..501
x=527, y=58..77
y=1695, x=559..564
x=589, y=907..932
y=977, x=674..679
y=552, x=569..594
x=601, y=1617..1631
x=470, y=1470..1483
x=660, y=740..765
y=219, x=503..507
x=501, y=486..488
x=554, y=905..916
y=766, x=535..539
y=1309, x=635..657
y=795, x=593..600
x=474, y=288..294
x=535, y=443..446
x=686, y=1042..1049
y=1168, x=677..680
x=606, y=414..422
y=1044, x=633..636
x=674, y=809..813
y=854, x=542..585
x=468, y=42..68
x=669, y=265..289
y=1063, x=545..564
x=617, y=1506..1519
y=571, x=586..600
y=1657, x=536..549
y=1049, x=673..686
x=672, y=809..813
x=612, y=1022..1038
y=1456, x=571..575
x=515, y=674..686
x=666, y=1178..1188
x=640, y=326..347
x=532, y=306..317
x=585, y=840..854
y=1038, x=612..627
y=285, x=674..680
x=498, y=1072..1075
y=165, x=580..583
x=581, y=1192..1202
y=311, x=596..611
y=1589, x=528..541
x=650, y=1723..1726
x=632, y=1652..1661
x=517, y=1391..1400
x=637, y=1349..1373
x=477, y=517..525
y=395, x=515..517
x=595, y=1060..1075
x=536, y=927..937
x=601, y=467..494
x=573, y=669..673
x=524, y=74..83
x=468, y=1307..1333
x=622, y=1783..1806
y=1373, x=637..640
x=575, y=53..62
x=475, y=487..488
y=250, x=497..515
x=653, y=1339..1341
x=607, y=231..237
x=667, y=200..203
y=42, x=525..530
y=1247, x=634..637
x=648, y=1351..1373
x=679, y=953..977
x=656, y=1565..1576
x=504, y=8..18
x=492, y=518..527
x=666, y=1456..1466
y=1624, x=587..594
y=1344, x=612..623
x=649, y=1302..1305
x=552, y=1217..1225
x=614, y=115..130
x=624, y=118..122
x=581, y=573..583
x=529, y=1676..1682
y=102, x=517..536
x=596, y=707..723
x=655, y=325..347
x=551, y=970..982
x=462, y=101..127
x=538, y=216..223
x=633, y=115..130
x=501, y=190..203
x=652, y=354..371
x=621, y=282..297
x=675, y=1497..1517
x=494, y=1567..1571
x=494, y=452..463
x=615, y=1765..1769
x=633, y=1372..1380
y=667, x=488..503
x=516, y=1286..1295
x=532, y=1676..1682
x=559, y=375..394
x=682, y=800..816
y=1520, x=467..492
x=637, y=1146..1149
x=621, y=1314..1318
x=537, y=1132..1142
x=600, y=327..338
y=83, x=482..524
x=659, y=244..261
y=1200, x=516..542
x=654, y=876..899
x=503, y=1345..1364
x=490, y=1713..1720
x=478, y=41..68
x=602, y=42..65
x=517, y=265..269
x=674, y=984..1007
y=1448, x=535..562
x=569, y=551..552
x=471, y=903..910
x=520, y=962..979
x=565, y=712..734
x=576, y=80..93
x=589, y=708..723
x=468, y=731..744
y=982, x=551..569
x=632, y=232..237
x=559, y=967..979
y=831, x=460..468
y=266, x=544..568
y=446, x=535..547
x=546, y=127..137
x=671, y=1061..1086
x=634, y=577..579
x=618, y=749..755
x=555, y=473..483
y=1179, x=501..529
y=1364, x=503..512
x=636, y=1671..1681
x=614, y=623..625
x=642, y=1740..1742
x=579, y=208..227
x=540, y=179..181
x=572, y=388..390
x=520, y=1590..1607
x=611, y=204..206
x=666, y=1318..1323
y=1670, x=505..513
x=524, y=237..251
y=1041, x=479..497
x=512, y=538..549
y=1290, x=638..659
x=647, y=442..452
x=609, y=868..870
x=537, y=1325..1327
x=637, y=391..404
y=1619, x=554..567
x=594, y=550..552
x=508, y=961..979
y=1038, x=541..545
y=870, x=644..668
y=1320, x=509..527
y=1279, x=650..652
x=528, y=925..934
y=1412, x=648..675
x=654, y=1637..1640
x=628, y=380..387
x=586, y=290..310
x=470, y=1094..1108
x=471, y=4..10
y=390, x=568..572
x=538, y=284..297
y=1519, x=617..637
x=682, y=833..845
x=647, y=1018..1037
y=1590, x=559..586
x=664, y=1594..1611
x=670, y=1634..1653
x=624, y=1655..1664
x=601, y=547..552
y=339, x=615..617
y=1241, x=491..514
y=451, x=589..610
x=653, y=1212..1221
x=547, y=594..595
x=475, y=1720..1722
x=616, y=353..365
x=549, y=326..335
y=985, x=479..489
x=609, y=1664..1666
x=643, y=1654..1664
x=532, y=1322..1337
x=677, y=724..727
x=651, y=1590..1604
x=628, y=1795..1798
x=460, y=1436..1460
x=540, y=28..30
x=514, y=817..840
x=632, y=1136..1146
x=649, y=354..371
x=585, y=1689..1711
x=587, y=1034..1050
y=578, x=536..562
x=491, y=1268..1273
y=65, x=595..602
y=1728, x=520..536
x=637, y=1740..1742
x=523, y=189..203
x=461, y=915..937
x=578, y=54..62
x=579, y=1800..1813
y=1641, x=616..619
x=488, y=456..458
x=545, y=1029..1038
x=649, y=1652..1664
y=552, x=601..629
x=557, y=180..181
y=663, x=493..497
x=633, y=1022..1044
x=599, y=1276..1277
y=405, x=578..604
x=555, y=1288..1300
x=602, y=458..464
x=650, y=548..575
x=612, y=1333..1344
x=492, y=817..840
x=634, y=1227..1247
x=536, y=1232..1243
x=506, y=61..63
x=608, y=1061..1075
x=551, y=1323..1337
x=517, y=91..102
y=1601, x=639..642
x=494, y=800..802
y=494, x=601..611
y=813, x=544..562
x=536, y=573..578
x=558, y=711..734
x=617, y=312..339
y=1514, x=473..475
x=487, y=1189..1203
y=873, x=529..599
x=543, y=1010..1019
x=574, y=1762..1772
x=559, y=650..677
x=567, y=1393..1402
x=673, y=1126..1143
x=531, y=1136..1139
x=660, y=498..520
y=464, x=602..617
x=531, y=1389..1394
y=122, x=624..626
x=547, y=1231..1243
x=650, y=1745..1752
x=495, y=1268..1273
x=565, y=1170..1181
y=1291, x=460..481
y=160, x=656..669
x=513, y=170..179
x=665, y=684..710
y=1249, x=592..614
y=155, x=530..532
x=664, y=1765..1769
x=625, y=1705..1709
x=554, y=1071..1085
y=98, x=527..529
x=684, y=1635..1653
x=493, y=287..294
x=608, y=1639..1649
x=567, y=342..367
x=564, y=619..624
x=596, y=1369..1381
x=616, y=1641..1643
x=652, y=1279..1281
x=628, y=1488..1502
y=371, x=649..652
y=1628, x=587..594
x=563, y=1653..1673
y=253, x=462..476
x=532, y=153..155
x=565, y=1394..1402
x=648, y=1389..1412
x=501, y=1256..1277
x=682, y=1548..1559
x=560, y=779..791
x=635, y=1297..1309
x=530, y=1072..1085
x=572, y=1190..1197
y=1806, x=622..640
y=763, x=573..578
x=564, y=1524..1527
y=118, x=624..626
x=687, y=723..727
y=548, x=481..502
y=849, x=571..575
y=1318, x=621..640
y=1592, x=544..552
y=85, x=641..665
y=1592, x=459..479
y=706, x=505..526
x=536, y=189..205
x=596, y=1719..1729
y=1466, x=666..672
y=54, x=548..560
x=565, y=1193..1202
x=577, y=669..673
y=787, x=565..576
y=1184, x=623..629