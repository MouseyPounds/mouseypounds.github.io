#!/bin/perl -w
#
# https://adventofcode.com/2017/day/19

use strict;

print "2017 Day 19\n\n";
my $puzzle = do { local $/; <DATA> }; # slurp it
my @grid = map { [split('')] } split("\n", $puzzle);

(my ($path, $steps)) = traverse_map(\@grid);
print "P1: The packet sees the following letters on its path: $path\n";
print "P2: The packet takes $steps steps on its path.\n";

sub traverse_map {
	my $map = shift;
	
	my $x = 0;
	my $y = 0;
	my $dir = 's';
	my %off = ( 'n' => [0, -1], 's' => [0, 1], 'e' => [1, 0], 'w' => [-1, 0] );
	my $height = scalar(@$map);
	my $width =  scalar(@{$map->[0]});
	# Find the entrance
	for ($x = 0; $x < $width; $x++) {
		last if ($map->[$y][$x] eq '|');
	}
	
	my @queue = ( { 'x' => $x, 'y' => $y } );
	my $path = "";
	my $steps = 0;
	while (my $p = shift @queue) {
		my $c = $map->[$p->{'y'}][$p->{'x'}];
		last if ($c eq " ");
		$steps++;
		if ($c =~ /[A-Z]/) {
			$path .= $c;
		} elsif ($c eq '+') {
			if ($dir eq 'n' or $dir eq 's') {
				if ($p->{'x'} < $width - 1 and $map->[$p->{'y'}][$p->{'x'} + 1] ne ' ') {
					$dir = 'e';
				} elsif ($p->{'x'} > 0 and $map->[$p->{'y'}][$p->{'x'} - 1] ne ' ') {
					$dir = 'w';
				} else {
					die "Stuck in corner at $p->{'x'}, $p->{'y'}";
				}
			} else {
				if ($p->{'y'} < $height - 1 and $map->[$p->{'y'} + 1][$p->{'x'}] ne ' ') {
					$dir = 's';
				} elsif ($p->{'y'} > 0 and $map->[$p->{'y'} - 1][$p->{'x'}] ne ' ') {
					$dir = 'n';
				} else {
					die "Stuck in corner at $p->{'x'}, $p->{'y'}";
				}
			}
		}
		$x = $p->{'x'} + $off{$dir}[0];
		$y = $p->{'y'} + $off{$dir}[1];
		push @queue, { 'x' => $x, 'y' => $y };
	}
	return $path, $steps;
}

__DATA__
                                                                                                           |                                                                                             
   +-----+                                         +---------------------------------+               +-----|-------------------------------------------------------+       +-------------------+         
   |     |                                         |                                 |               |     |                                                       |       |                   |         
   |     |                                         |                                 |               |     |   +----Q--------------------------+                 +---------|-------------------|-+       
   |     |                                         |                                 |               |     |   |                               |                 | |       |                   | |       
   |     |     +---------------------+             +-+                               |               |     |   |                               |                 | |       |           +-------+ |       
   |     |     |                     |               |                               |               |     |   |                               |                 | |       |           |         |       
   |     |     |       +-------------------------------------------------------------|---------------|---------|-----+                 +-------+                 | |     +-|-+         |         |       
   |     |     |       |             |               |                               |               |     |   |     |                 |                         | |     | | |         |         |       
   |     |     +-+     |             |               |                               |               |     |   |     |                 |                         | |     | | |         |         |       
   |     |       |     |             |               |                               |               |     |   |     |                 |                         | |     | | |         |         |       
   |     |       |     |             |               |               +---------------|---------------|-----|-------------+             |                   +-------------+ | |         |   +-----|---+   
   |     |       |     |             |               |               |               |               |     |   |     |   |             |                   |     | |       | |         |   |     |   |   
   |     |       |     |             |   +-----------|---------------|---------------|-----------------------------------|---------------------------------|-----|-|-------|-|---------|---+     |   |   
   |     |       |     |             |   |           |               |               |               |     |   |     |   |             |                   |     | |       | |         |         |   |   
 +-------|-------|-----|-----------------------------|---------------+               |   +-----------|-----|---+     |   |         +---|--T----------------------|---------|---------------------------+ 
 | |     |       |     |             |   |           |                               |   |           |     |         |   |         |   |                   |     | |       | |         |         |   | | 
 +-----+ |       |     |             |   |           |                               |   |           | +---|-----------------------|-------------------------------|-----+ | |         |   +---------+ | 
   |   | |       |     |             |   |           |                               |   |           | |   |         |   |         |   |                   |     | |     | | |         |   |     |     | 
   |   | |       |     |             |   |           |                               | +-------------|-|---------------------------|---|-----------------------------------|-|-----------+ |     | +-+ | 
   |   | |       |     |             |   |           |                               | | |           | |   |         |   |         |   |                   |     | |     | | |         | | |     | | | | 
   |   | |       |     |             |   |           |       +-----------------------|---|---------------------------|-------------------------------------------------------|---------+ +-+     | | +-+ 
   |   | |       |     |             |   |           |       |                       | | |           | |   |         |   |         |   |                   |     | |     | | |                   | |     
   |   | |       |     |             |   |           |       |                       | | |           | |   |         |   |         |   |       +-----------+     | |     | | |                   | |     
   |   | |       |     |             |   |           |       |                       | | |           | |   |         |   |         |   |       |                 | |     | H |                   | |     
   |   | |       |     |             |   |           +-------------------------+     | | |           | |   |         |   |         |   |       |                 | |     | | |                   | |     
   |   | |       |     |             |   |                   |                 |     | | |           | |   |         |   |         |   |       |                 | |     | | |                   | |     
   |   | |       |     |             |   |                   |               +-|---------|-----------|-|-------------|---|-----------------------------------------+     | | |                   | |     
   |   | |       |     |             |   |                   |               | |     | | |           | |   |         |   |         |   |       |                 |       | | |                   | |     
   |   | |   +-+ +-----|-------------|-------------------------------------------------|-------------------------------------------|-------------------------------------|-|-|-------------------------+ 
   |   | |   | |       |             |   |                   |               | |     | | |           | |   |         |   |         |   |       |                 |       | | |                   | |   | 
   +-----|---|-|-------+   +---------------------------------|-----------------------|-|-|-----------------|---------|---|---------|-----------|-------------------------|---|---------------+   | |   | 
       | |   | |           |         |   |                   |               | |     | | |           | |   |         |   |         |   |       |                 |       | | |               |   | |   | 
   +-----|---+ +-----------|---------|-----------------------|---------------|-------|-|-|-------------|---|---------|---|---------------------|-------------------+     | | |               |   | |   | 
   |   | |                 |         |   |                   |               | |     | | |           | |   |         |   |         |   |       |                 | |     | | |               |   | |   | 
   +-----|-------------------------------------------------------+           | |     | | |           | |   |         |   |         |   |       |                 | |     | | |               |   | |   | 
       | |                 |         |   |                   |   |           | |     | | |           | |   |         |   |         |   |       |                 | |     | | |               |   | |   | 
       | +---+             |       +-----------------------------+       +---|-|-----|-----------------|---|---------|---|---------|---|-----------------+       | |     | | |               |   | |   | 
       |     |             |       | |   |                   |           |   | |     | | |           | |   |         |   |         |   |       |         |       | |     | | |               |   | |   | 
       |     |             |     +---|---------------+       |           |   | |     | | |           | |   |         |   |         |   +-------------+   |       | |     | | |               |   | | +-+ 
       |     |             |     | | |   |           |       |           |   | |     | | |           | |   |         |   |         |           |     |   |       | |     | | |               |   | | |   
     +-|-----------+       |     | | |   |           |       |   +-------------------|---|-------------|---|-------------|---------------------|---------|-+     | |     | | |               |   | | |   
     | |     |     |       |     | | |   |           |       |   |       |   | |     | | |           | |   |         |   |         |           |     |   | |     | |     | | |               |   | | |   
     | |     |     |       |     | | |   |           |       |   |       |   | | +---------------------|---|-----------------+     |           |     |   | |     | |     | | |             +-----|-+ |   
     | |     |     |       |     | | |   |           |       |   |       |   | | |   | | |           | |   |         |   |   |     |           |     |   | |     | |     | | |             | |   |   |   
     | +-----------|-------+     | | |   |           |       |   |       |   | | |   | | |           | |   |         |   |   |     |           |     |   | |     | |     | | |             | |   |   |   
     |       |     |             | | |   |           |       |   |       |   | | |   | | |           | |   |         |   |   |     |           |     |   | |     | |     | | |             | |   |   |   
     |       |     |             | | |   |           |       |   |       |   | | |   | | |           | |   |         |   |   +-----|-----------------|---|-|-------------|---|-------------|-|---+   |   
     |       |     |             | | |   |           |       |   |       |   | | |   | | |           | |   |         |   |         |           |     |   | |     | |     | | |             | |       |   
     |       |     |       +-------|-|---|-------------------------------|-----|-----|---|-----------|-|---|---------------------------------------------|-|-----|-----+ | | |             | |       |   
     |       |     |       |     | | |   |           |       |   |       |   | | |   | | |           | |   |         |   |         |           |     |   | |     | |   | | | |             | |       |   
     |       |     |       | +-+ | | |   |           |       |   |       |   | | |   | +-+           | |   +---------|-------------|-----------|---------|-|-----|---------|-------------------------+   
     |       |     |       | | | | | |   |           |       |   |       |   | | |   |               | |             |   |         |           |     |   | |     | |   | | | |             | |           
     | +-----|---------------|-----+ |   |           |       |   |       |   | | |   |               | |             |   |         |           |     |   | |     | |   | | | |             | |           
     | |     |     |       | | | |   |   |           |       |   |       |   | | |   |               | |             |   |         |           |     |   | |     | |   | | | |             | |           
     | | +-------------------|-|-|---|---|-----------+       |   |       |   | | |   |               | |           +-|-------------|-----------|---------|-------|-|-----|-------------+   | |           
     | | |   |     |       | | | |   |   |                   |   |       |   | | |   |               | |           | |   |         |           |     |   | |     | |   | | | |         |   | |           
     | | |   |     |       | | | | +-----|-----------------------|---------------|---|---------------|-------------------|---------|---+ +-----|-----------|-----|-----|-------------+ |   | |           
     | | |   |     |       | | | | | |   |                   |   |       |   | | |   |               | |           | |   |         |   | |     |     |   | |     | |   | | | |       | |   | |           
     | | |   |     |       | | | | | |   |                   +-----------|---|-------|-----------------|---------------------------|---|-|-----|---------|-|-----|-------|---|-------|-|-+ | |           
     | | |   |     |       | | | | | |   |                       |       |   | | |   |               | |           | |   |         |   | |     |     |   | |     | |   | | | |       | | | | |           
   +---|-|-------------------|-----|-|---------------------------------------|-------|---------------|-|-----------------|---------|-----|-----------|-----|-----|-|---|-|-|-|---------+ | +-----------+ 
   | | | |   |     |       | | | | | |   |                       |       |   | | |   |               | |           | |   |         |   | |     |     |   | |     | |   | | | |       |   |   |         | 
   | | | |   |     |       | | | | | |   |                       |       |   | | |   |               | |           | |   +---------|---------------------+ |     | |   | | | |       |   |   |         | 
   | | | |   |     |       | | | | | |   |                       |       |   | | |   |               | |           | |             |   | |     |     |     |     | |   | | | |       |   |   |         | 
   | | | |   +---+ |       | | | | | |   |                       |       | +-|-+ |   |               +-|-----------------+         |   | | +---------|-----|-----|-----|---|-+     +-|---|-----------+ | 
   | | | |       | |       | | | | | |   |                       |       | | |   |   |                 |           | |   |         |   | | |   |     |     |     | |   | | |       | |   |   |       | | 
   | | | +---------|-----------|---|-------------------------------------|-|-|-------|-----------+     |           | |   |         |   | | |   |     |     |     | |   | | |       | |   |   |       | | 
   | | |         | |       | | | | | |   |                       |       | | |   |   |           |     |           | |   |         |   | | |   |     |     |     | |   | | |       | |   |   |       | | 
   | | |         | |       | | | | | |   |                       |       | | |   |   |           |     |           | |   +---------|-----|-----------|-----|---------------|-+     | |   |   |       | | 
   | | |         | |       | | | | | |   |                       |       | | |   |   |           |     |           | |             |   | | |   |     |     |     | |   | | | |     | |   |   |       | | 
 +---+ |         | |       | | | | | |   |                   +------------Y|-|---|---------------------------------|-|-------------|---|-|-----|-----------------------|---|-|-----|-----|-+ |       | | 
 | |   |         | |       | | | | | |   |                   |   |       | | |   |   |           |     |           | |             |   | | |   |     |     |     | |   | | | |     | |   | | |       | | 
 | |   |         | |   +---+ | | | | |   |                   |   |       | | |   |   |           |     |           | |             |   | | |   |     |     |     | |   | | | |     | |   | | |       | | 
 | |   |         | |   |     | | | | |   |                   |   |       | | |   |   |           |     |           | |             |   | | |   |     |     |     | |   | | | |     | |   | | |       | | 
 | |   |       +-|-|---|---+ | | | | |   |                   +-----------|-|-|---|---------+     |     |           | |             |   | | |   |     |     +-----|-----|---------+ | |   | | |       | | 
 | |   |       | | |   |   | | | | | |   |                       |       | | |   |   |     |     |     |           | |             |   | | |   |     |           | |   | | | |   | | |   | | |       | | 
 | |   |     +---|-|-------+ | | | | +-----------------------------------|-|---------|-----|-----------|-----------|-|---+         |   | | |   |     |           | |   | | | |   | | |   | | |       | | 
 | |   |     | | | |   |     | | | |     |                       |       | | |   |   |     |     |     |           | |   |         |   | | |   |     |           | |   | | | |   | | |   | | |       | | 
 | |   |     | | | | +---------|-|-------|-----------------------|-----+ | | |   |   |     +-----|-----------------|-------------------|-|-|-------+ |           +-----|---|-|---|-|-|-----+ |       | | 
 | |   |     | | | | | |     | | | |     |                       |     | | | |   |   |           |     |           | |   |         |   | | |   |   | |             |   | | | |   | | |   |   |       | | 
 | |   |     | | | | +-|-----|---|-|-----|-----------------------|-----|-------+ |   |           |     |           | |   |         |   | | |   |   | |             |   | | | |   | | |   |   | +---+ +-+ 
 | |   |     | | | |   |     | | | |     |                       |     | | | | | |   |           |     |           | |   |         |   | | |   |   | |             |   | | | |   | | |   |   | |   |     
 | |   |     | | | |   |     | | | |     |                     +-|-----|---|-|-|-|-----------+   |     |           | |   +---------------|-----|---|---------------|---|-|---------|-|---+   | | +-|---+ 
 | |   |     | | | |   |     | | | |     |                     | |     | | | | | |   |       |   |     |           | |             |   | | |   |   | |             |   | | | |   | | |       | | | |   | 
 | |   |     | | | |   |     | +---|-----|-----------+         | |     | | | | | |   | +---------|-----|-------------|---+         |   | | |   |   | |           +-----|-|-----+ | | +-+     | | | | +-+ 
 | |   |     | | | |   |     |   | |     |           |         | |     | | | | | |   | |     |   |     |           | |   |         |   | | |   |   | |           | |   | | | | | | |   |     | | | | |   
 | |   |     +---|-|---|---+ |   | |     |           |         | |     | | | | | |   | |     |   |     |           | |   +---+     |   | | |   |   | |           | |   | | | | | | |   | +---|---|-|-+   
 | |   |       | | |   |   | |   | |     |           |         | |     | | | | | |   | |     |   |     |           | |       |     |   | | |   |   | |           | |   | | | | | | |   | |   | | | |     
 | |   |       | | |   |   | |   | |     |           |       +-|-|-----------|---------|-----|---|-----+         +-|-|-------|-----|-----|-|---------|-----------|-------|-|-|---------|-+   | | | |     
 | |   |       | | |   |   | |   | |     |           |       | | |     | | | | | |   | |     |   |               | | |       |     |   | | |   |   | |           | |   | | | | | | |   |     | | | |     
 | |   |       | | |   |   | |   | |     |           |       | | |     | | | | | +---------------|---------------|---|-----------------------------|---------------|-----|-|---|-------|-----|-|-------+ 
 | |   |       | | |   |   | |   | |     |           |       | | |     | | | | |     | |     |   |               | | |       |     |   | | |   |   | |           | |   | | | | | | |   |     | | | |   | 
 | |   |       | | |   |   | |   | +-----|-------------------|---|-----|---|---------|-----------|---------------|-|-----+ +-------|-------|-+ |   | |           | |   | | | | | | |   |     | | | |   | 
 | |   |       | | |   |   | |   |       |           |       | | |     | | | | |     | |     |   |               | | |   | | |     |   | | | | |   | |           | |   | | | | | | |   |     | | | |   | 
 | |   |       | | |   |   | |   |       |           |       | | |     | | | +-|-------|-----|---|---------------|---------|-------|---|-|---|-|-----------------|-------|-|-|-|-|-|---|-------|---+ +-+ 
 | |   |       | | |   |   | |   |       |           |       | | |     | | |   |     | |     |   |               | | |   | | |     |   | | | | |   | |           | |   | | | | | | |   |     | | |   |   
 | |   |     +---|-|-------------|-------|-----------------------|-----|-|-|-----+   | |     |   |               | | |   | | |     |   +-------+   | |           | |   | | | | | | |   +-+   | | |   |   
 | |   |     | | | |   |   | |   |       |           |       | | |     | | |   | |   | |     |   |               | | |   | | |     |     | | |     | |           | |   | | | | | | |     |   | | |   |   
 | |   |     | | | +---|---|-----|-------|-+         |       | | |     | | |   | |   | |     |   |               | | |   | | |     |     | | |     | |           | |   | | | | | | |     |   | | |   |   
 | |   |     | | |     |   | |   |       | |         |       | | |     | | |   | |   | |     |   |               | | |   | | |     |     | | |     | |           | |   | | | | | | |     |   | | |   |   
 | |   |     | | |     |   | |   |       | |         |   +-------|---------|---|-|-----|-------------------------|-|-|---+ | +-----|-----+ | |     | |           | |   | +-----+ +-|-----|---|-+ |   |   
 | |   |     | | |     |   | |   |       | |         |   |   | | |     | | |   | |   | |     |   |               | | |     |       |       | |     | |           | |   |   | |     |     |   |   |   |   
 | |   |     | | |     |   | |   |       | |         |   |   | | |     | | |   | |   | |     | +-------------------|-------|---------+     | |     | |           | |   |   | | +-------------|-------+   
 | |   |     | | |     |   | |   |       | |         |   |   | | |     | | |   | |   | |     | | |               | | |     |       | |     | |     | |           | |   |   | | |   |     |   |   |       
 | |   |     | | |     |   | |   |       | |         |   |   | | |     | | |   | |   | |     | | |               | +-|-----|---------------|-------|---------------|-+ | +-|---|-+ +---------|---|---+   
 | |   |     | | |     |   | |   |       | |         |   |   | | |     | | |   | |   | |     | | |               |   |     |       | |     | |     | |           | | | | | | | | |       |   |   |   |   
 | |   |     | | |     |   | |   |       | |         |   |   | | |     | | |   | |   | |     | | |               |   |     |       | |     | |     | |           | | | | | | | | |       |   |   |   |   
 | |   |     | | |     |   | |   |       | |         |   |   | | |     | | |   | |   | |     | | |               |   |     |       | |     | |     | |           | | | | | | | | |       |   |   |   |   
 | |   |     | | |     |   | |   |       | |         |   |   | | |     | | |   | |   | |     | | |               |   |     |       | |     | |     | |           | | | | | | | | |       |   |   |   |   
 | |   |     | | |     |   | |   |       | |         |   |   | | |     | | |   | |   | |     | | |               |   |     |       | |     | |     | |           | | | | | | | | |       |   |   |   |   
 | |   |     | | |     |   | |   |       | |         |   |   | | |     | | |   | |   | |     | | |               |   |     |       | |     | | +-----|-------------|-------|-|-|---------|---|-----+ |   
 | |   |     | | |     |   | |   |       | |         |   |   | | |     | | |   | |   | |     | | |               |   |     |       | |     | | |   | |           | | | | | | | | |       |   |   | | |   
 | |   |     | | |     |   | |   |       | |         |   |   | | |     | | |   | |   | |     | | |               |   |     |       | |     | | |   | |           | | | | | | | | |       |   |   | | |   
 | A   |     | | |     |   | |   |       | |         |   |   | | |     | | |   | |   | |     | | |               |   |     |       | |     | | |   | |           | | | | | | | | |       |   |   | | |   
 | |   |     | | |     |   | |   |       | |         |   |   | | |     | | |   | |   | |     | | |               |   |     |       | |     | | |   | |           | | | | | | | | |       |   |   | | |   
 | |   |     | | |     |   | |   |       | |         |   |   | | |     | | |   | |   | |     | | |               |   |     |       | |     | | |   | |           | | | | | | | | |       |   |   | | |   
 | |   |     | +-----------|-------------|-----------------------------|-|-----|-|---|-|-----|---|-----------------------------------|-------------|---------------------|-----|-+       |   |   | | |   
 | |   |     |   |     |   | |   |       | |         |   |   | | |     | | |   | |   | |     | | |               |   |     |       | |     | | |   | |           | | | | | | | |         |   |   | | |   
 | |   |     |   |     |   | |   |       | |         |   |   | | |     | | |   | |   | |   +---|-----------------|---|---------------|-----+ | |   | |           | | | | | | | |         |   |   | | |   
 | |   |     |   |     |   | |   |       | |         |   |   | | |     | | |   | |   | |   | | | |               |   |     |       | |       | |   | |           | | | | | | | |         |   |   | | |   
 | |   |     |   |     |   | |   |       | |         |   |   | | |     | | |   | |   | |   | | | |               |   |     |       | |       | |   | |           | | | | | | | |         |   |   | | |   
 | |   |     |   |     |   | |   |       | |         |   |   | | |     | | |   | |   | |   | | | |               |   |     |       | |       | |   | |           | | | | | | | |         |   |   | | |   
 | | +-------|---|-----|-------------------|-------------------|-|-------------|-|---------|-|-|-----------------|---|-------------|-|-+     | |   | |           | | | | | | | |         |   |   | | |   
 | | | |     |   |     |   | |   |       | |         |   |   | | |     | | |   | |   | |   | | | |               |   |     |       | | |     | |   | |           | | | | | | | |         |   |   | | |   
 | | | |     |   |     |   | |   |       | |         |   |   | | | +-------|---------|-----|-|-|-|---------------------------------|-|-|-----|-|-------------------|-+ +-|---+ |         |   |   | | |   
 | | | |     |   |     |   | |   |       | |         |   |   | | | |   | | |   | |   | |   | | | |               |   |     |       | | |     | |   | |           | |     | |   |         |   |   | | |   
 | | | |     |   |   +-----------------------------------|---|-|-------|-|-|---|-|---+ |   | | | |               |   |     |       | | |     | |   | |           | |     | |   |         |   |   | | |   
 | | | |     |   |   | |   | |   |       | |         |   |   | | | |   | | |   | |     |   | | | |               |   |     |       | | |     | |   | |           | |     | |   |         |   |   | | |   
 | | | |     |   |   | |   | |   |       | |         |   |   | | | |   | | |   | |     |   | | | |   +-----------|---------|-------|-------+ +-----+ |           | |     | +---|---------|---+   | | |   
 | | | |     |   |   | |   | |   |       | |         |   |   | | | |   | | |   | |     |   | | | |   |           |   |     |       | | |   |   |     |           | |     |     |         |       | | |   
 | | | |     |   |   | |   | |   |       | |         |   |   | | | |   | | |   | | +-------|-|-|-----|-----------|-------------------|---------------|-----------|-------------|---------|---------+ |   
 | | | |     |   |   | |   | |   |       | |         |   |   | | | |   | | |   | | |   |   | | | |   |           |   |     |       | | |   |   |     |           | |     |     |         |       |   |   
 | | | |     |   |   | |   | |   |       | |         |   |   | | | |   | | |   | | |   |   | | | |   |           |   |     |       | | |   |   |     |           | |     |     |         |       |   |   
 | | | |     |   |   | |   | |   |       | |         |   |   | | | |   | | |   | | |   |   | | | |   |           |   |     |       | | |   |   |     |           | |     |     |         |       |   |   
 | | | |     |   |   | |   | |   |       | |         |   |   | | | |   | | |   | | |   |   | | | |   |           |   |     |       | | |   |   |     |         +---|-----|-----+         |       |   |   
 | | | |     |   |   | |   | |   |       | |         |   |   | | | |   | | |   | | |   |   | | | |   |           |   |     |       | | |   |   |     |         | | |     |               |       |   |   
 | | | |     |   |   | |   | |   |       | |         |   |   | | | |   | | |   | | |   |   | | | |   |           |   |     |       | | |   |   |     |         | | |     |               |       |   |   
 | | | |     |   |   B |   | |   |       | |         |   |   | | | |   | | |   | | |   |   | | | |   |           |   |     |       | | |   |   |     |         | | |     |               |       |   |   
 | | | |     |   |   | |   | |   |       | |   +-----|---|---|-----------------------------+ | | |   |           |   |     |       | | |   |   |     |         | | |     |               |       |   |   
 | | | |     |   |   | |   | |   |       | |   |     |   |   | | | |   | | |   | | |   |     | | |   |           |   |     |       | | |   |   |     |         | | |     |               |       |   |   
 | | | |     |   |   | |   +-|---|-------|-------------------------|---|-------|-|-|-------------+   |           |   |     |       | | |   |   |     |         | | |     |               |       |   |   
 | | | |     |   |   | |     |   |       | |   |     |   |   | | | |   | | |   | | |   |     | |     |           |   |     |       | | |   |   |     |         | | |     |               |       |   |   
 | | | |     +-------|-|-----|---|-------|-----+     |   |   | | | |   | | |   | | |   |     | |     |         +-|---|---------------|-|---|---|-----|---------|---------------+         |       |   |   
 | | | |         |   | |     |   |       | |         |   |   | | | |   | | |   | | |   |     | |     |         | |   |     |       | | |   |   |     |         | | |     |     |         |       |   |   
 +-|-----------+ |   +-------|---|-------|---------------|---------------|-------|-----------|-------|---------|-|---|-----|-------|---|-------|-----|-----+   | | |     |     |         |       |   |   
   | | |       | |     |     |   |       | |         |   |   | | | |   | | |   | | |   |     | |     |         | |   |     |       | | |   |   |     |     |   | | |     |     |         |       |   |   
 +-|---+       | |     +-----------------------------|---|-----|-|-|---|---+   | | |   +---+ +-------|---------|-|---------|---------|-+   |   |     |     |   | +-|-----------|---------------+ |   |   
 | | |         | |           |   |       | |         |   |   | | | |   | |     | | |       |   |     |         | |   |     |       | |     |   |     |     |   |   |     |     |         |     | |   |   
 | | |         | |           |   |       | |     +---|-------|-----|-----|-+   | | |       |   |     |         | |   |     |       | |     |   |     |     |   |   |     |     |         |     | |   |   
 | | |         | |           |   |       | |     |   |   |   | | | |   | | |   | | |       |   |     |         | |   |     |       | |     |   |     |     |   |   |     |     |         |     | |   |   
 | | |         +-|-+     +---------------|-|-----|-------|---|-|-|-+   | | +-----|-------+ +---------|-+       | |   |     |       | |     |   |     |     |   |   |     |     |         |     | |   |   
 | | |           | |     |   |   |       | |     |   |   |   | | |     | |     | | |     |     |     | |       | |   |     |       | |     |   |     |     |   |   |     |     |         |     | |   |   
 | | |     +-----|-|---------|---|-------|-|-----|---|---------------------------+ |     |     |     +---------|-|---|---------------|-----|---------+     |   |   |     |   +-|---------|-----|-|-+ |   
 | | |     |     | |     |   |   |       | |     |   |   |   | | |     | |     |   |     |     |       |       | |   |     |       | |     |   |           |   |   |     |   | |         |     | | | |   
 | | |     |     | |     |   |   |       | |   +-----|-----------|-------|-+   | +-|-----|-----|-------|-------------|-----|-------|-------|---|---------------|---|-----------|---------|-----|-+ | |   
 | | |     |     | |     |   |   |       | |   | |   |   |   | | |     | | |   | | |     |     |       |       | |   |     |       | |     |   |           |   |   |     |   | |         |     |   | |   
 | | | +---|-----|-----------|---|-------|-------|---|---|-----|-|-------------|---------|---------------------|-|-------------------------+   |           |   |   |     |   | |         |     +---+ |   
 | | | |   |     | |     |   |   |       | |   | |   |   |   | | |     | | |   | | |     |     |       |       | |   |     |       | |         |           |   |   |     |   | |         |           |   
 | | | |   |     | |     |   +---|---------------|-+ |   |   | | |     | | |   | | | +---|-----|-------|-------------|-----------------------------------------|---|---------|---+       |           |   
 | | | |   |     | |     |       |       | |   | | | |   |   | | |     | | |   | | | |   |     |       |       | |   |     |       | |         |           |   |   |     |   | | |       |           |   
 | | | | +-|---+ | |     |       |       | |   +-|-|-----|-----------------|---+ | | |   |     |       |       | |   |     |       | |         |           |   |   |     |   | | |       |           |   
 | | | | | |   | | |     |       |       | |     | | |   |   | | |     | | |     | | |   |     |       |       | |   |     |       | |         |           |   |   |     |   | | |       |           |   
 | | +-----|-------|-----|---------------|-------|-|-------------|-----|-----------|-|-------------------------|-----|-----|-------|-----------|-----------|---|---|--------M|---+     +-|-----------|-+ 
 | |   | | |   | | |     |       |       | |     | | |   |   | | |     | | |     | | |   |     |       |       | |   |     |       | |         |           |   |   |     |   | |       | |           | | 
 | | +-|-------|-|-------|-------|---------|---------|---------------------|---------|---|-+   |       +-------|-----------|-------|-----------|-------------------|-----|-+ | |     +---+           | | 
 | | | | | |   | | |     |       |       | |     | | |   |   | | |     | | |     | | |   | |   |               | |   |     |       | |         |           |   |   |     | | | |     | |             | | 
 | | +-+ +---------|-------+     |       | |     | | |   |   | | | +---+ | |   +-|-|-|---+ +---------------------+   |     |       | |         |           |   |   |     | | | |     | |             | | 
 | |       |   | | |     | |     |       | |     | | |   |   | | | |     | |   | | | |         |               |     |     |       | |         |           |   |   |     | | | |     | |             | | 
 | |     +-|---|-|-------------------------|-------|---------|-|-|-|-----------|---+ +-------------------+ +---------|-----+       | |         |           |   |   |     | | | |     | |             | | 
 | |     | |   | | |     | |     |       | |     | | |   |   | | | |     | |   | |             |         | |   |     |             | |         |           |   |   |     | | | |     | |             | | 
 | |     | |   | | |     | |     |       | |     | | |   |   | | | |     | |   | |             |         | |   |     |             | |         |           |   |   |     | | +---------|-----------+ | | 
 | |     | |   | | |     | |     |       | |     | | |   |   | | | |     | |   | |             |         | |   |     |             | |         |           |   |   |     | |   |     | |           | | | 
 | |     | |   | | |     | |     |       | |     | | |   |   | | | |     | |   | |             |         | |   |     +---------------|---------+   +-------|---|---------|-+ +-|-------|-+         | | | 
 | |     | |   | | |     | |     |       | |     | | |   |   | | | |     | |   | |             |         | |   |                   | |             |       |   |   |     |   | |     | | |         | | | 
 | |     | |   | | |     | |     |       | |     | | |   |   | | | +-----------|-+             |         | +---|---------+         | |             |       |   |   |     |   | |     | | |         | | | 
 | |     | |   | | |     | |     |       | |     | | |   |   | | |       | |   |               |         |     |         |         | |             |       |   |   |     |   | |     | | |         | | | 
 | | +-----+   +-|-+     | |     |       | |     | | |   |   | | |       | +---+       +-----------------------------------------------------------------------|-----------+ | |   +---|-|-------------+ 
 | | |   |       |       | |     |       | |     | | |   |   | | |       |             |       |         |     |         |         | |             |       |   |   |     | | | |   | | | |         | |   
 | | |   |       |       +---------------|-------|---|---------------------------------+       |         |     |     +---+         | |             |   +-------------+   | | | |   +---|-|-------------Z 
 | | |   |       |         |     |       | |     | | |   |   | | |       |                     |         |     |     |             | |             |   |   |   |   | |   | | | |     | | |         | |   
 | +-|---+       |       +-|-----+       | |     | | |   |   | | |       |                     |         +-------------------------|-------------+ +---|---|---|---------------|-----|-+ +-----+   +-|-+ 
 |   |           |       | |             | |     | | |   |   | | |       |                     |               |     |             | |           |     |   |   |   | |   | | | |     |         |     | | 
 |   |     +-----|-------|-+         +---|-------|-------------|-|-------|-------------------------------------|-------------------|-|-----------|-----|-------|---|-|-------|-|---------------|-----|-+ 
 |   |     |     |       |           |   | |     | | |   |   | | |       |                     |               |     |             | |           |     |   |   |   | |   | | | |     |         |     |   
 |   |     |     |       |     +-----------------|-|-|-------------------+         +-----------|---------------------|-------------|-------------+     |   |   +---|-|---+ | | |     |         |     |   
 |   |     |     |       |     |     |   | |     | | |   |   | | |                 |           |               |     |             | |                 |   |       | |     | | |     |         |     |   
 |   +-------------------|-----------|---+ |     | +---+ +-------|-----------------+           |               |     +-+           +-|-----+           |   +-------------------|---+ +-----------------+ 
 |         |     |       |     |     |     |     |   | |     | | |                             |               |       |             |     |           |           | |     | | |   |           |     | | 
 |         |     |       +-----------------|-------------+   | | |                             +-------------+ +-------+             | +---|-------------------------------+ | +---|-----+     +-----|-+ 
 |         |     |             |     |     |     |   | | |   | | |                                           |                       | |   |           |           | |       |     |     |           |   
 |         |     |             |     +-----------|---|---|---|-+ |                                           |                       | +---|-----------|-----------+ |       |     |     |           |   
 |         |     |             |           |     |   J | |   |   |                                           |                       |     |           |             |       |     |     |           |   
 +---------|-----|-------------|-----------|---------|-|-----|-----------------------------------------------|-----------------------|-----|---------------------------------------------|-+         |   
           |     |             |           |     |   | | |   |   |                                           |                       |     |           |             |       |     |     | |         |   
           |     |   +---------+     +-+   +-----+   | | |   |   |       +-----------------------------------+       +---------------+     |           |           +---------|-----------+ |         |   
           |     |   |               | |             | | |   |   |       |                                           |                     |           |           | |       |     |       |         |   
           +-----|-------------------+ |             | | | +-------------+ +---------------------------------------------------------------+           +-----------+ +-------+     +---+   +---------+   
                 |   |                 |             | | | | |   |         |                                         |                                                                 |                 
                 +---+                 +-------------+ +-+ +-+   +---------+                                         +-----------------------------------------------------------------+                 
                                                                                                                                                                                                         
