#!/bin/perl -w
#
# https://adventofcode.com/2020/day/20

use strict;
use POSIX;
use List::Util qw(product);
use Storable qw(dclone);

$| = 1;

print "2020 Day 20\n";

# For the input data, we only need to read the edges but we are also preserving a copy of the internal image
my %tile = ();
my $cur_tile = "";

while (<DATA>) {
	chomp;
	next if ($_ eq '');
	if (/^Tile (\d+):/) {
		$cur_tile = $1;
		$tile{$cur_tile} = { 'l' => "", 'r' => "", 'image' => [] };
	} else {
		$tile{$cur_tile}{'l'} .= substr($_, 0, 1);
		$tile{$cur_tile}{'r'} .= substr($_, -1, 1);
		if (not exists $tile{$cur_tile}{'t'}) {
			$tile{$cur_tile}{'t'} = $_;
		} else {
			if (exists $tile{$cur_tile}{'b'}) {
				my $len = (length $tile{$cur_tile}{'b'}) - 2;
				push @{$tile{$cur_tile}{'image'}}, [split('', substr($tile{$cur_tile}{'b'}, 1, $len))];
			}
			$tile{$cur_tile}{'b'} = $_;
		}
	}
}

# To identify the corners, we will focus on connected edges; for each tile, we try to match its edges to the edges of all the
# other tiles and count the common edges: 2 common edges for corners, 3 for non-corner sides, and 4 for interior tiles.
# We are going to start with the last tile we read in from the input, find its connectors, then find their connectors, etc.
# Along the way, new tiles are rotated & flipped as necessary to be consistent with the orientation of the first tile checked.
my @corners = ();
my @edges = qw(t b l r);
my %opposite = ( 't' => 'b', 'b' => 't', 'l' => 'r', 'r' => 'l' );
my %connection = ();
my %to_check = ();
map { $to_check{$_} = "" } keys %tile;
my @tile_queue = ();
while (scalar(keys %to_check) > 0 and defined $cur_tile) {
	my $common = 0;
	delete $to_check{$cur_tile};
	LOOP: foreach my $next_tile (keys %tile) {
		next if ($cur_tile eq $next_tile);
		for (my $e = 0; $e <= $#edges; $e++) {
			my $ce = $edges[$e];
			my $flipped = reverse $tile{$cur_tile}{$ce};
			for (my $ee = 0; $ee <= $#edges; $ee++) {
				my $ne = $edges[$ee];
				if ($tile{$cur_tile}{$ce} eq $tile{$next_tile}{$ne}) {
					if ($ce ne $opposite{$ne}) {
						if (($ce eq 't' and $ne eq 'l') or ($ce eq 'b' and $ne eq 'r')) {
							rotate_tile(\%tile, $next_tile, 'ccw');
						} elsif (($ce eq 'r' and $ne eq 'b') or ($ce eq 'l' and $ne eq 't')) {
							rotate_tile(\%tile, $next_tile, 'cw');
						} elsif (($ce eq 't' and $ne eq 'r') or ($ce eq 'b' and $ne eq 'l')) {
							rotate_tile(\%tile, $next_tile, 'cw');
							flip_tile(\%tile, $next_tile, 'h');
						} elsif (($ce eq 'r' and $ne eq 't') or ($ce eq 'l' and $ne eq 'b')) {
							rotate_tile(\%tile, $next_tile, 'ccw');
							flip_tile(\%tile, $next_tile, 'v');
						} elsif (($ce eq 'b' and $ne eq 'b') or ($ce eq 't' and $ne eq 't')) {
							flip_tile(\%tile, $next_tile, 'v');
						} elsif (($ce eq 'r' and $ne eq 'r') or ($ce eq 'l' and $ne eq 'l')) {
							flip_tile(\%tile, $next_tile, 'h');
						}
						$ne = $opposite{$ce};
					}
					$connection{$cur_tile}{$ce} = "$next_tile:$ne";
					$connection{$next_tile}{$ne} = "$cur_tile:$ce";
					$common++;
					push @tile_queue, $next_tile;
					next LOOP;
				} elsif ($flipped eq $tile{$next_tile}{$ne}) {
					if (($ce eq 't' and $ne eq 'b') or ($ce eq 'b' and $ne eq 't')) {
						flip_tile(\%tile, $next_tile, 'h');
					} elsif (($ce eq 'r' and $ne eq 'l') or ($ce eq 'l' and $ne eq 'r')) {
						flip_tile(\%tile, $next_tile, 'v');
					} elsif (($ce eq 't' and $ne eq 'l') or ($ce eq 'b' and $ne eq 'r')) {
						rotate_tile(\%tile, $next_tile, 'ccw');
						flip_tile(\%tile, $next_tile, 'h');
					} elsif (($ce eq 'r' and $ne eq 'b') or ($ce eq 'l' and $ne eq 't')) {
						rotate_tile(\%tile, $next_tile, 'cw');
						flip_tile(\%tile, $next_tile, 'v');
					} elsif (($ce eq 't' and $ne eq 'r') or ($ce eq 'b' and $ne eq 'l')) {
						rotate_tile(\%tile, $next_tile, 'cw');
					} elsif (($ce eq 'r' and $ne eq 't') or ($ce eq 'l' and $ne eq 'b')) {
						rotate_tile(\%tile, $next_tile, 'ccw');
					} elsif ($ce eq $ne) {
						flip_tile(\%tile, $next_tile, 'v');
						flip_tile(\%tile, $next_tile, 'h');
					}
					$ne = $opposite{$ce};
					$connection{$cur_tile}{$ce} = "$next_tile:$ne";
					$connection{$next_tile}{$ne} = "$cur_tile:$ce";
					$common++;
					push @tile_queue, $next_tile;
					next LOOP;
				}
			}
		}
	}
	push @corners, $cur_tile if ($common == 2);
	while ($cur_tile = shift @tile_queue) {
		last if (exists $to_check{$cur_tile});
	}
}

print "\nP1: Found corners of (", join(", ", @corners), ") with a product of ", product(@corners), ".\n";

# Time to build the image. We will start in one of the corners and work through similar to how we did connections.
# The goal is to get a grid of tile IDs which we will then use to populate the actual image.
map { $to_check{$_} = "" } keys %tile;
$cur_tile = $corners[0];
my %by_id = ( $cur_tile => [0,0] );
my %by_co = ( "0,0" => $cur_tile );
my %offset = ('t' => [0, -1] , 'b' => [0, 1], 'l' => [-1, 0], 'r' => [0, 1]);
my $min_x = 0;
my $min_y = 0;
@tile_queue = ();
while (scalar(keys %to_check) > 0 and defined $cur_tile) {
	delete $to_check{$cur_tile};
	my $x = $by_id{$cur_tile}[0];
	my $y = $by_id{$cur_tile}[1];
	foreach my $c (keys %{$connection{$cur_tile}}) {
		(my ($next, $ne)) = split(":", $connection{$cur_tile}{$c});
		if (not exists $by_id{$next}) {
			my $xx = $x + $offset{$c}[0];
			$min_x = $xx if ($xx < $min_x);
			my $yy = $y + $offset{$c}[1];
			$min_y = $yy if ($yy < $min_y);
			$by_id{$next} = [$xx, $yy];
			$by_co{"$xx,$yy"} = $next;
			push @tile_queue, $next;
		}
	}
	while ($cur_tile = shift @tile_queue) {
		last if (exists $to_check{$cur_tile});
	}
}	
#print_tile_markers(\%by_co);

my @full_image = ();
my $tile_height = (length $tile{$corners[0]}{'l'}) - 2;
my $image_y = 0;
my $size = sqrt(scalar(keys %tile));
for (my $y = $min_y; $y < $min_y + $size; $y++) {
	for (my $yy = 0; $yy < $tile_height; $yy++) {
		$full_image[$image_y+$yy] = [];
		for (my $x = $min_x; $x < $min_x + $size; $x++) {
			push @{$full_image[$image_y+$yy]}, @{$tile{$by_co{"$x,$y"}}{'image'}[$yy]};
		}
	}
	$image_y += $tile_height;
}

# Here we account for all possible orientations of the image and count the sea monsters for all just in case the
# sea monsters themselves have varying orientations. To get the final "water roughness" count we just count all the
# '#' in the full image and subtract 15 for each sea monster since the monsters should not overlap.
my $sea_monsters = 0;
for (my $r = 0; $r < 4; $r++) {
	rotate_image(\@full_image, 'cw');
	$sea_monsters += check_for_sea_monsters(\@full_image);
	flip_image(\@full_image, 'v');
	$sea_monsters += check_for_sea_monsters(\@full_image);
	flip_image(\@full_image, 'v');
}
my $rough_water = count_occupied(\@full_image);
print "P2: Found $sea_monsters Sea Monsters and a water roughness of ", ($rough_water - 15 * $sea_monsters), ".\n";

sub print_tile_markers {
	my $ref = shift;
	
	my ($min_x, $min_y, $max_x, $max_y);
	foreach my $k (keys %$ref) {
		my ($x,$y) = split(',', $k);
		$min_x = $x if (not defined $min_x or $x < $min_x);
		$min_y = $y if (not defined $min_y or $y < $min_y);
		$max_x = $x if (not defined $max_x or $x > $max_x);
		$max_y = $y if (not defined $max_y or $y > $max_y);
	}
	for (my $y = $min_y; $y <= $max_y; $y++) {
		for (my $x = $min_x; $x <= $max_x; $x++) {
			print $ref->{"$x,$y"}, " ";
		}
		print "\n";
	}
}

sub print_image {
	my $image = shift;

	for (my $y = 0; $y <= $#$image; $y++) {
		print join("", @{$image->[$y]}), "\n";
	}
}

sub count_occupied {
	my $image = shift;

	my $count = 0;
	for (my $y = 0; $y <= $#$image; $y++) {
		for (my $x = 0; $x <= $#{$image->[$y]}; $x++) {
			$count++ if $image->[$y][$x] eq '#';
		}
	}
	return $count;
}

# Sea Monsters look like this, where the "." is not necessarily an empty tile
# ..................#.
# #....##....##....###
# .#..#..#..#..#..#...
sub check_for_sea_monsters {
	my $image = shift;
	
	my $num = 0;
	my %top = ();
	my %mid = ();
	my %bot = ();
	
	for (my $y = 0; $y <= $#$image; $y++) {
		my $line = join('', @{$image->[$y]});
		while ($line =~ /(?=(#....##....##....###))/g) {
			$mid{"$y,$-[0]"} = "";
		}
		while ($line =~ /(?=(.#..#..#..#..#..#...))/g) {
			$bot{"$y,$-[0]"} = "";
		}
	}
	foreach my $b (keys %bot) {
		(my ($y, $x)) = split ',', $b;
		if ($y >= 2) {
			$num++ if (exists $mid{($y-1) . ",$x"} and $image->[$y-2][$x+18] eq '#');
		}
	}
	return $num;
}	

sub rotate_image {
	my $image = shift;
	my $dir = shift;
	
	my $old_image = dclone($image);
	if ($dir eq 'cw') {
		for (my $y = 0; $y <= $#$image; $y++) {
			for (my $x = 0; $x <= $#{$image->[0]}; $x++) {
				my $xx = $#$image - $y;
				my $yy = $x;
				$image->[$yy][$xx] = $old_image->[$y][$x];
			}
		}
	} else {
		for (my $y = 0; $y <= $#$image; $y++) {
			for (my $x = 0; $x <= $#{$image->[0]}; $x++) {
				my $xx = $y;
				my $yy = $#{$image->[$y]} - $x;
				$image->[$yy][$xx] = $old_image->[$y][$x];
			}
		}	
	}
}

sub flip_image {
	my $image = shift;
	my $dir = shift;

	my $old_image = dclone($image);
	if ($dir eq 'h') {
		for (my $y = 0; $y <= $#$image; $y++) {
			@{$image->[$y]} = reverse @{$image->[$y]};
		}	
	} else {
		@$image = reverse @$image;
	}
}

sub rotate_tile {
	my $tiles = shift;
	my $which = shift;
	my $dir = shift;

	my $old_image = dclone($tiles->{$which}{'image'});
	if ($dir eq 'cw') {
		my $old_t = $tiles->{$which}{'t'};
		$tiles->{$which}{'t'} = reverse $tiles->{$which}{'l'};
		$tiles->{$which}{'l'} = $tiles->{$which}{'b'};
		$tiles->{$which}{'b'} = reverse $tiles->{$which}{'r'};
		$tiles->{$which}{'r'} = $old_t;
		for (my $y = 0; $y <= $#{$tiles->{$which}{'image'}}; $y++) {
			for (my $x = 0; $x <= $#{$tiles->{$which}{'image'}[0]}; $x++) {
				my $xx = $#{$tiles->{$which}{'image'}} - $y;
				my $yy = $x;
				$tiles->{$which}{'image'}[$yy][$xx] = $old_image->[$y][$x];
			}
		}
	} else {
		my $old_t = $tiles->{$which}{'t'};
		$tiles->{$which}{'t'} = $tiles->{$which}{'r'};
		$tiles->{$which}{'r'} = reverse $tiles->{$which}{'b'};
		$tiles->{$which}{'b'} = $tiles->{$which}{'l'};
		$tiles->{$which}{'l'} = reverse $old_t;
		for (my $y = 0; $y <= $#{$tiles->{$which}{'image'}}; $y++) {
			for (my $x = 0; $x <= $#{$tiles->{$which}{'image'}[0]}; $x++) {
				my $xx = $y;
				my $yy = $#{$tiles->{$which}{'image'}[$y]} - $x;
				$tiles->{$which}{'image'}[$yy][$xx] = $old_image->[$y][$x];
			}
		}	
	}
}
	
sub flip_tile {
	my $tiles = shift;
	my $which = shift;
	my $dir = shift;

	if ($dir eq 'h') {
		my $old_r = $tiles->{$which}{'r'};
		$tiles->{$which}{'r'} = $tiles->{$which}{'l'};
		$tiles->{$which}{'l'} = $old_r;
		$tiles->{$which}{'t'} = reverse $tiles->{$which}{'t'};
		$tiles->{$which}{'b'} = reverse $tiles->{$which}{'b'};
		for (my $y = 0; $y <= $#{$tiles->{$which}{'image'}}; $y++) {
			@{$tiles->{$which}{'image'}[$y]} = reverse @{$tiles->{$which}{'image'}[$y]};
		}
	} else {
		my $old_t = $tiles->{$which}{'t'};
		$tiles->{$which}{'t'} = $tiles->{$which}{'b'};
		$tiles->{$which}{'b'} = $old_t;
		$tiles->{$which}{'l'} = reverse $tiles->{$which}{'l'};
		$tiles->{$which}{'r'} = reverse $tiles->{$which}{'r'};
		@{$tiles->{$which}{'image'}} = reverse @{$tiles->{$which}{'image'}};
	}
}


__DATA__
Tile 3469:
.##..#.#.#
##..#...##
...#..##.#
....#.#..#
#..#.##...
.#.##.#.##
..#.#.....
..###.#..#
#.##.#...#
....#...##

Tile 3739:
..##..#..#
#.#...#..#
.....#.##.
.#..#....#
#.....#...
#..##.#..#
####.#.##.
##..#.#..#
..#......#
#..#.##.##

Tile 3581:
####.#..##
..#......#
.##...#...
#....#.###
..#..#.#..
#...#.....
#..####...
......#...
..#...#.##
##.#..#..#

Tile 2521:
..#.##..##
..#.#..##.
#.........
#.#.......
.#........
#.....#..#
..........
.#........
#........#
#.....#.#.

Tile 2729:
...##...##
....#..#..
#...##....
##.#......
#..#..#.##
.#...#...#
....#.##..
#.....##.#
#....##..#
......#.#.

Tile 2137:
#.#...#.##
#.......#.
.#.#..#..#
##.....#.#
.....#...#
...#......
#........#
....#....#
.......#..
.#.#.#####

Tile 1451:
...#.#.##.
##.#......
.###...#.#
..##....##
....##....
...#..#...
...#..#.#.
##..#....#
#..#...##.
.###....##

Tile 2927:
.#...#....
.#.......#
#...#....#
##.......#
..#....#.#
#.#....#..
#....#..##
#........#
#.#.......
#########.

Tile 2179:
...#..#..#
#....##...
....#...##
...#.#..##
#........#
..#.#...##
.#........
.###.####.
....#.#..#
..#.#.....

Tile 2267:
#.##...##.
.....#...#
..###...##
.....#..##
.....#...#
##........
#..#..#...
....##....
....#....#
###.####..

Tile 2423:
....###.##
#....#.#..
#......#.#
...#.....#
......#..#
.#......##
#.#......#
..........
...#..##..
##.##...##

Tile 3989:
.#.#....#.
#........#
..##....##
.#.###.##.
.....#....
#...##.##.
#....##..#
#.........
#....#....
.#..###...

Tile 1913:
.####...##
#.........
....#...#.
#.......##
#...#....#
#...#.....
.#.##...#.
.......#..
##..#...#.
.##..#.##.

Tile 2017:
.#.##.###.
#.....#...
..#..#...#
#........#
......#.#.
#...#....#
#.#.#...#.
.###.#....
.##...####
#.##.#####

Tile 1277:
.##...#.##
#..#.....#
#.#.#...##
#.#.#...##
.####....#
....#....#
.....#....
#....####.
#.........
#...#...#.

Tile 1999:
.##.##..#.
#.........
#...#.....
...#......
#.#.....#.
....#....#
........##
#......#.#
..#.#....#
.#.#.#....

Tile 2803:
#......##.
..##.##...
...#.#....
#...#....#
....#.#..#
#...#...##
.........#
#...#.##..
....##.#.#
#..#..#.#.

Tile 1801:
...#.###.#
...#.###..
...##..#.#
....##.###
##.......#
....#.#..#
##.###..#.
...#...#.#
#.##..##..
###......#

Tile 1009:
...#..#.#.
#.##.#....
#.....##..
#.#..#....
#.........
#....#.#.#
#....##..#
..##......
..#.#...#.
##.###.#.#

Tile 3329:
..#.###...
.#....#.#.
..........
#....##..#
##.##..###
..........
..........
#...#.#...
###.#..###
#####.##.#

Tile 3719:
..#.###.#.
#....#...#
##..#.##.#
....#.###.
##.....#.#
##....#...
##.......#
#.#......#
.##...#.#.
####..##.#

Tile 2381:
##.#......
#.....#...
#.....#...
.....##...
..##...##.
###......#
#.....#.##
..#...####
#.#...#..#
#..#......

Tile 2593:
###.#.###.
..#.##..##
#.#......#
....#.####
..#...##.#
..#.#.#...
#.##......
..#..#...#
.##.##...#
.###.##.##

Tile 3559:
...#...#..
#..#.#.#..
..........
.#.#......
..#......#
....#....#
.......###
...#..###.
..#.#...#.
..#.##.##.

Tile 2953:
#.##.....#
.........#
#...#.....
#...#....#
...#....#.
#..#...#..
#.....#.##
#...#.#..#
...###..##
..#..##..#

Tile 1283:
..#..#.#.#
##.....#.#
.........#
#.....#...
###......#
..#.#.####
#..#.....#
..#...#..#
###.##....
...#...###

Tile 2897:
.......###
##.#....#.
#.....####
##...#...#
.....#....
#.....#...
.##...##..
.....#...#
......#..#
.#....##.#

Tile 3779:
###..####.
#..##..#.#
#.#...#..#
......#..#
#....#....
...#...##.
......####
##....#..#
#.#....#..
#####....#

Tile 2693:
#.#.#.####
..........
#.#.#....#
..#.#..#.#
##.....#.#
##....#...
.##.#.....
##.......#
.....#....
.###.#..#.

Tile 1453:
#..##....#
#..#....#.
#.#....##.
.##.#....#
..#.#....#
.###.....#
....##....
#...##...#
#.###.....
.##....#..

Tile 1459:
.##.##.###
..#.......
......##.#
##...#...#
#.#.....##
#.#......#
...##.#...
###..#...#
...#....#.
...##.#.##

Tile 1109:
#.#.#.#..#
#..#.####.
.....##..#
.##...#..#
.#...###.#
........#.
.....#.#.#
...#...###
....#.#..#
##..#..##.

Tile 3943:
...###....
##...###.#
####.....#
#.........
.#......#.
..#..#.#.#
..#....#..
##..#....#
#..#.....#
#.##..#.##

Tile 1129:
###...##..
....#....#
#........#
#......#..
..#...#...
#......#.#
....#...#.
.....#....
##......##
#..####.#.

Tile 2837:
...###.#.#
#......#..
..#.....##
.....#...#
#......#..
..........
#......#..
#.#.....##
#.#.#.....
.####.##..

Tile 3299:
####..#...
#........#
#...#..#.#
#.#....#..
#...#.....
...##.#..#
#.#.....##
..##......
#...#.#..#
#.###..##.

Tile 1493:
#..##..#.#
###......#
..........
...#.....#
....#.....
...#.....#
.#........
...###..#.
.#.#...#.#
####.#.#..

Tile 3931:
#.####....
.....###.#
...#....#.
#.#....#.#
#..#.....#
#........#
...##..#..
.....#....
#..#...#.#
#.###.##..

Tile 2879:
#####.....
##.#.#...#
#.....#.##
##....#.##
#..#......
#.#...#...
..#.....#.
...#...###
...#....##
.#.###.#..

Tile 2617:
##.#.#.#.#
.....#.#..
#...#.....
#...##...#
.#.......#
#.#.......
##..#.....
#......###
..#..#...#
.###..#..#

Tile 2383:
..#.#..#.#
#..#......
#...#.#...
....##...#
.#..#.#..#
#####....#
#.#......#
#........#
..##...###
.##.##.###

Tile 3373:
.##..####.
...#..#.##
#..#.....#
####...#.#
#..#..#...
#.#....##.
##.#....##
.#..##..#.
.##..#...#
######..#.

Tile 3803:
.#..#.##..
.......##.
#....#....
..#......#
...##.....
#.........
..##......
#.#...#..#
..##.....#
#..#####..

Tile 3677:
.#.#####.#
#...#.....
.....#....
..#......#
.#.#...#.#
..###.##..
##...##..#
#..#......
#...#..#..
...#####.#

Tile 3323:
####.#..#.
#..#.##..#
#.........
.#.......#
#.#.....#.
#..#.....#
#....##.#.
.......#.#
#####..#..
.#.##.####

Tile 3457:
.#.#..#..#
.#..#.....
..##..#...
......#..#
.#.....#.#
#.........
#..#..#.#.
#####....#
###.#...#.
#..###.###

Tile 1303:
##..#.####
#.#..#....
.....#...#
#.#.......
#..####...
#...##....
###..#..##
##.......#
#...#..#.#
#..#.#..##

Tile 2687:
.####...##
#..#.....#
..#...#...
##.....#.#
#.....#..#
#.........
...#.#...#
.........#
#..#.....#
#.##.#...#

Tile 1907:
..#....###
....#...##
..#.##..#.
.#....##..
......#...
......#.#.
#.....#.##
..#...#...
....#....#
#####.####

Tile 3217:
#.##.##...
#..#.##...
.#..#.##..
#.....#.#.
....#.....
###.#.##..
.#.#.###..
#.........
#......#.#
#.###..##.

Tile 3923:
#.##.#..##
......#..#
#.....#...
..#.#.....
#........#
.#...#...#
.....#...#
.#..#.##.#
..#..#...#
..#####.##

Tile 2239:
#.#.###.##
#..#..#...
.##..#....
#...##..#.
#........#
..#.#.....
##.##.....
#.#..###.#
##..##....
#.#.#..##.

Tile 1823:
###..###..
.#.##...#.
..###....#
#.#..#...#
###.#.....
#.#...#.##
#...##..##
##.#...#.#
#....#.###
.#.##.#..#

Tile 2711:
.#.#.....#
.....#..##
..#..#..##
#.........
..........
#.##..##.#
####..####
###.......
........#.
.#.#.####.

Tile 1123:
###.#.##.#
........##
.......##.
.#........
.#....#..#
###.#.##..
..##......
#.#.#.....
##...#..##
###..#####

Tile 3659:
...##.##..
.#....#...
.#..#.....
..........
.....#.#..
...#...###
#.....#...
.#........
#..#......
#...#.#..#

Tile 3499:
###..##.#.
#..##....#
###.#.....
#####.....
..#.......
###..#.#..
......##.#
.#.......#
#.##.#...#
.#.#.##.##

Tile 3019:
#..#.###..
....#....#
.#......##
###.#....#
..#.#.....
..##....#.
.#..#..#.#
.........#
....#...##
##..#.#..#

Tile 3529:
####....##
..##...#.#
#.........
...#......
......#..#
##......##
#.##....##
##.#...#.#
#.#.......
###.##..#.

Tile 1733:
##..#....#
....#.....
#.#......#
..#..#...#
...#....#.
.....#....
.......#.#
......#..#
#.#.#..###
.###.#.##.

Tile 1367:
#.#.###.#.
#.##.##.#.
##..#.##..
#.....####
.##...#..#
...##.#..#
#.......##
.##..##..#
#.##......
#...###...

Tile 2557:
##.#######
#..#####..
##.#.#...#
#..#.#....
.#..#....#
###...#..#
##..#.#...
#...##..##
#.#.##.#.#
#.#...#..#

Tile 2081:
.###..#..#
.....#....
##.....#..
..........
..........
#.##......
.........#
......#.#.
...#.....#
...###.#.#

Tile 3391:
.##.#.....
...###...#
..#.##....
#...#.#..#
#......##.
#........#
...#..#..#
.....#....
.#...#....
##....#...

Tile 2657:
#.#.##.#..
##...#....
..#...#...
#.........
.........#
##........
##...#....
##.....#..
...#...#.#
##...###..

Tile 1429:
.###.....#
#........#
..#.#..#..
.......###
.......#..
.......##.
##..#...##
.#......#.
..#....#..
.##.##....

Tile 2339:
.#.####...
#......#..
#.#...##..
##....##.#
......##.#
.#......#.
.#...#..##
#........#
#.##.#.###
..#..#.#..

Tile 2347:
..###..###
..###.....
#..#..##..
#......#..
#.#..#.#.#
......##..
.#..#..#..
..#.....##
#.##..##..
#..###....

Tile 2957:
...#.####.
#.....#...
#..#......
#.....#.#.
..#.#..#.#
....#...##
###.#.##.#
.#...##..#
#........#
#.#.####..

Tile 2477:
.###.##.##
.#.....#..
#......#..
....##.#..
##........
..#....#.#
##...#.###
.#.#..#...
..#..#.#.#
.....#.#.#

Tile 1669:
#.##..#.##
.#......#.
#####..#.#
..##...#.#
#.#..#....
##........
##.#......
##..#....#
##.#..#..#
##...##.##

Tile 2887:
######.#..
#..#..##.#
#..#..#..#
#..###..#.
#........#
.....##..#
.#..##.#..
..........
##..#.#..#
##.#..#..#

Tile 3517:
.#....#.##
#..#.##.#.
..........
##...#..##
#.........
#...#.#..#
#...#..#..
...#......
..........
#......#.#

Tile 3257:
####.....#
.#...##...
#.#.#.#..#
#.##......
##.#..#...
.##.##..#.
#......#.#
..##......
#...#....#
#...##.###

Tile 2029:
#.#.....##
.........#
.#..#.....
...#.....#
...#.###.#
....#.#..#
..........
#..#..#...
#........#
.#####..##

Tile 1777:
###....#..
#..#......
......##..
.....#.#..
##....#..#
#..#...#..
..##....##
##..#..#..
#......#.#
.#.....##.

Tile 3881:
#..###..#.
##.#.##..#
#.........
#...#.#..#
#.........
.#..#.#.##
....#.....
#..###.#..
#..##.#..#
###..#.#.#

Tile 3919:
.##..##..#
..........
......#...
..........
...#.#..##
#........#
......###.
#....#.##.
..#.....##
.##.##....

Tile 1051:
####..###.
.....##...
#.#......#
..#.....#.
#....#...#
##.#..####
......####
#..#.....#
#......#..
##.#####..

Tile 2539:
.#.#.#..##
.#.#.#..##
..##...#.#
...#...#.#
#...#..##.
#...##.##.
.#....#..#
....#...#.
#.##..###.
.##.###...

Tile 2833:
#####.###.
.#...#...#
.........#
..#.#.#..#
####..#..#
#..#......
#.##..#...
#.##....##
#.#..#.##.
##.#.##.#.

Tile 1297:
.#.#.####.
..........
##..#####.
#....##..#
.#.......#
.#.##.....
#.#.#.#..#
...#..#...
#...#.#..#
.#...#####

Tile 1093:
.##..#...#
#.#.#.....
....#...#.
...#....##
....##..#.
#.......##
...#.#...#
#...#.#..#
....#..#.#
####.#.#..

Tile 2843:
.#.#..##..
..#...###.
....#.#..#
###..#.##.
..#....#..
#.........
#...#..#.#
#.#...#..#
##..####..
...#####..

Tile 2243:
...##..#.#
.......#..
#........#
....#....#
.........#
#..#......
..#..#.#.#
.#.#.##...
#...##.#..
....###.##

Tile 1091:
..######.#
.##..#..#.
........##
##..#.#.#.
.....###..
..#...#..#
..#.#.#...
...#.....#
#.#.##.#.#
#.....##.#

Tile 2609:
#.#.#...##
#..#..#..#
...####...
..#.#..#.#
#...##.#..
#.##.#..##
#..##....#
#.#...#.#.
.#...##...
.#.###...#

Tile 3527:
.#....###.
#..#...#.#
........##
#.#..#..#.
.......#.#
........##
#.....#...
##..####..
#..##...#.
.#.#.##..#

Tile 1229:
.#####.##.
...#.#....
#.#.##...#
.#...##..#
#....#...#
#.#..#...#
.#....#...
....#....#
#.#......#
#.#####.##

Tile 2549:
.#####....
#........#
.#.##.....
#.#...#..#
#.#......#
...#..#..#
...#...#..
##...##..#
.#.#......
####.#...#

Tile 2131:
#.#..#.#.#
##..#.....
#.#..##..#
#...#....#
###.......
#..#######
....#.....
#...#....#
...#.#...#
#...#...#.

Tile 1201:
#...#.#.##
.....#....
##..#.#..#
...#..#..#
.....#...#
..##..#.##
#.#.#..#.#
.....#.#.#
###.#.#..#
..#.##...#

Tile 1321:
.#..#...##
#.#...##..
...#.....#
#....##..#
#.........
.#.......#
#.##....#.
.#..##.###
#...#...##
#.########

Tile 2999:
.......#..
.....#....
.##.......
#..#.....#
#...#.....
####.#..#.
.#...###.#
##.....#.#
#.####...#
.##.......

Tile 1621:
####.....#
..#..#..#.
.#...###..
##...##...
#..#......
#..##.#...
...#..#..#
.##...##.#
......#..#
.#..#...#.

Tile 1483:
.#####..#.
.#...#...#
#.#.#..#..
....####..
#..#..####
...##.....
....#.#...
..#..##...
#..##.#...
.###...#.#

Tile 1579:
.#..######
##..#....#
..#......#
#...#..#..
#........#
#.#.#.#..#
#..#.##.##
#....##.##
.#....##..
##...#####

Tile 2251:
.#.###..##
...##....#
........##
..#..#####
#..#..#..#
#......#..
##.##....#
#........#
........##
#.###...#.

Tile 1511:
#..##.##.#
..#.....##
##.......#
##...#...#
#.##.##.##
#......#..
#..#......
#.#...##.#
.#........
..#..##.##

Tile 3613:
##.###..##
....#..##.
##..#.#...
..###.##.#
.#.###....
#.#.##....
.#.#..##..
#.......#.
......###.
.#..###.##

Tile 1663:
#...#...##
......#.#.
###.#.#..#
#..#......
#.....#.#.
..........
#.....##..
..........
...#.#...#
#.##..#...

Tile 1997:
##...#....
.#.#.....#
##.#.#....
.#.#..#...
...#.#....
.##.##.##.
#...####.#
..#.......
#.#...#...
.#..#.....

Tile 2371:
#.###.#...
##...###.#
#....##.##
#......#.#
##..##....
#.#...##.#
##...##..#
.....#...#
.##.......
##.....#.#

Tile 3709:
.#..##.#.#
###.#..#..
##.#..##..
##.....#.#
..........
#......##.
....#...#.
.#...#....
.#......##
.#....####

Tile 2143:
######.#..
##..#...#.
#...#.....
.#.#...#.#
.....#....
........##
#..#......
.#.#.....#
...#....##
....#..##.

Tile 2621:
##.##.##..
....#..#.#
#..###....
#....#....
.........#
##....#...
###..#...#
.##.......
.#....#.##
..#..#####

Tile 3221:
.....#....
.....##.#.
.......#..
#...#.....
#..#.#...#
#.#....#.#
#........#
.......##.
#.#......#
#..#.#..#.

Tile 1447:
.##..####.
#........#
.#......#.
........##
...#..####
.#....#...
###...#..#
.#..#.#..#
#.##.#...#
.##.#####.

Tile 2551:
.#####..#.
......#...
..#.......
.##.##..##
..#..#....
#..#.....#
......#.##
#.....#..#
#...#..##.
..##...#..

Tile 2851:
####.##..#
..........
....##...#
##.......#
...##..#.#
.#......##
.......#..
#..#.#....
.#.....#.#
.#...#..##

Tile 2129:
#.#.####..
.#.....#..
#.........
#..#......
#.#...#...
#......#..
.#....#..#
..#.#..#.#
#..#....##
#.##.###.#

Tile 1753:
#..#...#.#
##.......#
#....##.#.
#.......##
#...#...##
#.##......
...#..##..
...#.....#
###......#
#......#.#

Tile 1471:
####..##.#
#......##.
#..##.#...
.#...#..##
##.#.#.#.#
......#..#
#...#....#
#....#..#.
#..#..##..
.##.#.###.

Tile 1019:
#..####...
.....#....
#.........
..#......#
#.#..#....
.##.#.#...
....#....#
#...##...#
...#......
#..#####.#

Tile 3467:
......####
#....##.##
...##..#.#
#.....##..
#.##.#...#
..##...###
........#.
#......##.
.......##.
####.#.#.#

Tile 1223:
.#.#..##.#
#.........
#.#...#..#
.....#...#
###..#....
#..###...#
.....#..##
#..#..##..
.#.###....
##.##.##.#

Tile 2293:
##..#..##.
......#...
#......#..
..#.......
#..#...###
..#....##.
......####
....###.#.
#..##.##.#
..#...#..#

Tile 2647:
.#.#......
..#..##..#
.....#....
#......##.
#........#
#.#..#...#
#....##..#
##...#....
....#....#
#.#...####

Tile 1931:
.#..##.#.#
##.#.....#
#...#....#
#....#.#.#
.#....##.#
...#..#..#
##..##...#
##........
.#..#....#
...#..###.

Tile 2819:
.##.###.#.
.........#
#...#....#
#...#.##..
.....##.#.
.#..##...#
#....#..#.
#..#.##.##
#..##....#
.......###

Tile 2749:
##..#...#.
#..##....#
###......#
##...#.##.
#.###..##.
.#.##....#
#.......#.
...#...#..
#...#...#.
.#..##...#

Tile 2309:
#......###
##....#..#
#..#...###
#.......##
##........
..#####..#
..##..#..#
..#.......
#......#..
.###..#.##

Tile 2203:
..#..#..#.
.#....##.#
.........#
...#.#....
#.....#...
.......#..
#........#
#....#..##
.....#.#.#
.#.###.###

Tile 1697:
...#.#..#.
#.......#.
.##....#.#
#....#.##.
....#..###
....#..#.#
....#..#.#
##..##..##
.......#..
..#.#.#...

Tile 3413:
#.#.#...##
......#..#
...###....
...###....
....#.#..#
.....##...
.........#
......#...
.....#....
.##....#..

Tile 3169:
..#.#.##..
..........
#.........
##..#..##.
......#..#
#..#.#....
#.#.......
.......##.
..#.##.#..
.#..##.##.

Tile 2153:
#.#.#.#.##
#.....#..#
........##
#....##...
#...#....#
#.#.......
#.####..#.
...#.###.#
..#.#.....
##.##.##.#

Tile 1031:
.######.#.
....##...#
...##...#.
....##..##
.#...##...
.........#
.#...#..#.
......#..#
..##.....#
##....####

Tile 1097:
.#.#.#.###
#..###.#.#
....#.....
...#..#..#
.#....##.#
#..#.#....
....#..##.
##.###.#.#
...#.#..#.
.#.#.##...

Tile 1789:
###...##..
#.........
...#.....#
#....#....
##...#....
...#...#..
....#..#.#
..........
..#.#..#.#
###.#..###

Tile 3701:
#...#.#.##
#.#...#..#
#....#...#
.....#..##
#.....##.#
...#..##.#
#.....#...
#...#.....
#.......#.
#...#.##.#

Tile 3617:
#...##.#..
..##...#..
...##.....
.#.....###
..#.#####.
###.#.#.#.
.#.#.#...#
#....##...
#.....###.
##.#...###

Tile 3727:
####...##.
#..#....##
##.#.##..#
...##.##..
....#.....
##....##..
#....##.##
....##....
##..##....
.#....##.#

Tile 3343:
...##.#...
..#.#.....
.....#..#.
#...##.#..
#.#.#....#
...#......
....##..##
...#######
.#..#....#
.#.###...#

Tile 3313:
...####.##
#.#.#.....
#..##...##
.#.#.##..#
#...#....#
..#..#....
.#..#.....
##.##...##
...#......
.###....##

Tile 1847:
..##.##.##
##...#.#..
##...#....
#.#......#
#....#....
.......##.
##.#.#.#.#
...#..#..#
....#..#..
#..##..##.

Tile 3557:
..#..#####
......#..#
#.....#..#
..#.......
#.......##
###.#....#
.#.....#.#
##........
#...#.....
.##...#.##

Tile 1867:
...##.###.
#......##.
#.#.#...#.
#........#
#.....#...
#....#...#
.#..#.#...
...###....
##.#..#.##
#..#.###..

Tile 2039:
##.#.#####
#.#....#..
.#.#.....#
##.....#..
###..#..##
....#.....
##..##....
.........#
..#.#.#..#
###...#.##

Tile 3301:
..#..##..#
....#...#.
#....###..
.....#..#.
....##...#
#......#..
....#....#
......####
.......###
..#..###.#

Tile 1213:
..#.#..#..
#.#....###
..#......#
##.#......
..#....###
...#.....#
.#.#.....#
#.#.....##
..##.#..#.
...#...#.#

Tile 2437:
#.#####.##
.##...#.##
#..#.#...#
.....#....
.##...#.#.
....##.#..
#...#.....
##.#..#..#
#....#..##
.#.######.

Tile 3511:
.#.###.##.
...#...#..
#...#.##.#
.....#....
.#........
........#.
##.#......
....#.....
....#...#.
.#.##..##.

Tile 2719:
..#.#.###.
#.##...#..
...#..##..
#........#
.........#
.....####.
#.....#.#.
#.#.......
...#...##.
###.##..#.
